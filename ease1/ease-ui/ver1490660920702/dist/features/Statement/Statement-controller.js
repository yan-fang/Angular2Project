define(["angular","easeModal"],function(e){"use strict";var t=e.module("StatementModule");return t.controller("statementController",["$scope","$state","$window","accountDetailsData","stCategory","lstStatementData","StatementService","pdfDelegate","EaseLocalizeService","EASEUtilsFactory","easeExceptionsService","EaseConstant",function(t,n,a,r,o,s,i,l,u,c,m,f){function d(){h.file=null,h.pdfUrl=null,h.currentIdx=0,h.currentStatement={}}function S(){var e={lob:h.currentStatement.lob,accountRefId:h.currentStatement.accountRefId};i.getListStaments(e,h.statementYear).then(function(e){h.lstStatements=e.lstStatements})}function g(e){if(e&&4===e.length)return Number(e);throw m.createEaseException({module:"StatementModule","function":"statementController.getCurrentYear(year)",message:"The current year shouldnt be null && lenght ==  4 digits",fileName:"Statement-controller.js",lineNumber:46})}function p(e){var t=e||!0;t?(h.message.title=h.i18n.messageErrorTitle,h.message.content=h.i18n.messageErrorContent):(h.message.title=h.i18n.noStatementsTitle,h.message.content=h.i18n.noStatementsContent),h.showMessage=!0}function v(){if(!h.currentStatement)return void h.reset();var t=e.extend(h.currentStatement,{lob:h.lob(),accountRefId:r.accountRefId||r.accountDetails.referenceId,isAdaStatement:h.isAdaStatement});i.getStatement(t).then(function(e){h.pdfUrl=e.url,h.isLoading=!0,h.delegate.getPdf(h.pdfUrl,!1).then(function(e){h.accessor.renderPdf&&h.accessor.renderPdf(e)}),h.currentIdx=h.lstStatements.indexOf(h.currentStatement),h.isServiceWorking=!0},function(e){throw h.isServiceWorking=!1,p(!0),h.delegate.load("/ease-ui"+f.kBuildVersionPath+"/dist/file/NotFound.pdf"),e})}t.init=function(){h.lineOfBusiness=c.getLOB(h.category),h.totalStatements>0&&(h.currentStatement=i.getLatestStatement(h.lstStatements)[0],h.currentStatement?(h.statementYear=g(h.currentStatement.statementYear),v()):h.statementYear=(new Date).getFullYear())};var h=this;u.get("statements").then(function(e){h.i18n=e,h.isServiceWorking&&0===h.totalStatements?p(!1):h.isServiceWorking?h.showMessage=!1:p(!0)},function(e){throw h.isServiceWorking=!1,m.createEaseException({module:"StatementModule","function":"statementController",fileName:"Statement-controller.js",lineNumber:17,message:"getting data for I18N : "+e.statusText,cause:e})}),e.extend(h,{currentIdx:0,file:{},pdfUrl:"",httpHeaders:{},initClose:!1,modalType:"statementPane",modalClass:"",opened:!1,on:!0,toggle:!0,currentStatement:{},delegate:l,scalePdf:f.kDefaultPdfScale,accessor:{},isLoading:!1,isServiceWorking:!1,accountDetailsData:"undefined"!=typeof r?r.accountDetails:{},category:o.toUpperCase(),message:{},showMessage:!1,templateCalendar:"/ease-ui/dist/features/Statement/html/partials/Statement-calendar.html",lstStatements:s.lstStatements||"undefined",quarterlyStatements:s.quarterlyStatements,lineOfBusiness:""}),h.totalStatements=function(){var e=0;return c.isTypeOfArray(h.lstStatements)?(h.isServiceWorking=!0,e=h.lstStatements.length):h.isServiceWorking=!1,e}(),e.extend(h,{lob:function(){return c.getLOB(h.category)},getAriaText:function(e,t){return"q"===t?"Statements for "+this.quarterlyStatements[e].title:"Statement for "+c.getFullMonthText(e)},close:function(){d(),n.go("^")},reset:function(){d(),h.delegate.load("/ease-ui"+f.kBuildVersionPath+"/dist/file/NotFound.pdf")},download:function(){if(!a.saveAs)throw m.createEaseException({module:"StatementModule","function":"statementController.download",fileName:"Statement-controller.js",lineNumber:84,message:"download function is not supported"});a.saveAs(h.file,"statement.pdf")},printStatement:function(){var e=a.open(h.pdfUrl);if(!e)throw m.createEaseException({module:"StatementModule","function":"statementController.printStatement",fileName:"Statement-controller.js",lineNumber:108,message:"print function is not supported"});e.print()},changeStatement:function(e){h.currentStatement=e,h.currentStatement.available&&(v(),h.toggle=!0)},zoomIn:function(){h.scalePdf=h.delegate.zoomIn()},zoomOut:function(){h.scalePdf=h.delegate.zoomOut()},prev:function(){h.statementYear=h.statementYear-1,S()},retriveQuaterly:function(e){},retrieveYearly:function(){},next:function(){h.statementYear=h.statementYear+1,S()},havePrev:function(){return!0},haveNext:function(){return!0},getDate:function(e){var t=new Date(e.statementDate);return t.getDate()},showYearlySummary:function(e){for(var t=0;t<e.length;t++)if(!e[t].available)return!1;return!0}}),t.init()}]),t});