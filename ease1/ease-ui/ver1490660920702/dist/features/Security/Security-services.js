define(["angular","jsencrypt"],function(e){"use strict";function t(e,t,r,n,c,a){function s(){var n=r.defer();return c.clearCustomerActivityHeader(),e.setBaseUrl(t.baseUrl),e.one("customer/getHeader").get().then(function(e){n.resolve(e),i(e.username)},function(e){n.reject(e)}),n.promise}function o(s){var o=r.defer();e.setBaseUrl(t.baseUrl),c.clearCustomerActivityHeader(),c.setCustomerActivityHeader("50080");var u=e.all(t.kchangePassword),i={newPasswordTLNPI:a.encryptData(s.newPasswordTLNPI),currentPasswordTLNPI:a.encryptData(s.currentPasswordTLNPI)};return u.post(i).then(function(e){/SUCCESS/.test(e.changePasswordStatus)?o.resolve(e):o.reject()})["catch"](function(e){throw o.reject(),n.createEaseException({module:"security.service","function":"changePassword",cause:e})}),o.promise}function u(){return l}function i(e){l=e}function y(s){var o=r.defer();e.setBaseUrl(t.baseUrl),c.clearCustomerActivityHeader(),c.setCustomerActivityHeader("50100");var u=e.all(t.kchangeUserName),y={newUsername:a.encryptData(s.username),currentPasswordTLNPI:a.encryptData(s.currentPasswordTLNPI)};return u.customPUT(y).then(function(e){/SUCCESS/i.test(e.resetUsernameStatus)?(o.resolve(e),i(s.username)):o.reject()})["catch"](function(e){throw o.reject(),n.createEaseException({module:"security.service","function":"changeUsername",cause:e})}),o.promise}return{changePassword:o,fetchUsername:s,updateUsername:y,getUserName:u};var l}function r(e,t,r,n){function c(e){return i.setPublicKey(o()),i.encrypt(e)}function a(){var c=r.defer();return""===o()?(e.setBaseUrl(t.baseUrl),n.clearCustomerActivityHeader(),e.one("customer/security/encryption").get().then(function(e){s(e.encryptionKey),c.resolve(e.encryptionKey)},function(e){c.reject(e)})):c.resolve(o()),c.promise}function s(e){u=e}function o(){return u}var u="",i=new JSEncryptExports.JSEncrypt;return{encryptData:c,getEncryptionKeyFromServer:a,setEncryptionKey:s,getEncryptionKey:o}}e.module("SecurityModule").factory("SecurityFactory",t).factory("encryptionFactory",r),t.$inject=["Restangular","EaseConstant","$q","easeExceptionsService","EASEUtilsFactory","encryptionFactory"],r.$inject=["Restangular","EaseConstant","$q","EASEUtilsFactory"]});