define(["angular"],function(e){"use strict";var t=e.module("UMMPaymentModule");return t.controller("AddExternalAccountCtrl",["$scope","EaseLocalizeService","UmmPaymentFactory","EASEUtilsFactory","pubsubService","displayModal","$timeout","ContentConstant","$state","$rootScope","languagePreferencesFactory","EaseConstant",function(t,a,n,c,o,s,r,l,i,u,d,y){var m=this,g={};m.tooltipOptions={position:"top",attrs:[{key:"role",value:"presentation"},{key:"aria-labelledby",value:"lblSetPrimaryAct"}]},m.accountFields={},m.accountFields.primaryAct=!1,o.pubsubTrackAnalytics({name:"add payment account:button"}),o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"add payment account",level3:"",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""}),a.get("payment").then(function(e){m.i18n=e},function(e){console.log(e)}),m.contentDataAddExtAcct=n.getContentOneData()[l.kCoreAddExternalAccounts+d.currentLocale.replace("-","_")],m.extFeatToggleData=n.getFeatToggleData(),m.isButtonClicked=!1,e.extend(m,{checkImage:"abaNumberImg_"+d.currentLocale.replace("-","_"),isAccPreferencesState:"AddExtAccount"===i.current.name,modalType:"externalPayment",populateAccountTypeValues:function(e){return g=n.populateAccountTypeValues(e)},showDefaultPrimary:function(){return m.extFeatToggleData[y.features.combinedmoneymovementAccounts]&&m.extFeatToggleData[y.features.defaultPaymentAccount]},addPayment:function(){return m.extFeatToggleData[y.features.combinedmoneymovementAccounts]?m.addExtMoneyMovAcc():m.addExternalAccount()},addExternalAccount:function(){m.loadingClass="loading";var e={accountNumberTLNPI:t.addExtPayAcct.accountFields.accountNumber,abaNumber:t.addExtPayAcct.accountFields.abaNumber,accountType:t.addExtPayAcct.accountFields.accountType.value,accountUseDescription:t.addExtPayAcct.accountFields.accountType.accountUseDescription};n.saveExternalAccount(e,y.kSaveExtBankUrl,"50042").then(function(e){if(m.loadingClass="",e.easeDisplayError&&e.easeDisplayError.displayMessage)if("1"!==e.easeDisplayError.severity){m.errorText=e.easeDisplayError.displayMessage;var a=document.getElementById("errorText");a.setAttribute("tabIndex","-1"),r(function(){a.focus()})}else m.deleteModal=!0,i.go("customerSettings.settings");else o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"add payment account",level3:"confirmation",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""}),m.errorText="",m.isAccPreferencesState?(m.deleteModal=!0,t.$modalCancel(),s.displayAddExtAccountSuccess()):(t.addExtPayAcct.accountFields.paymentAccountReferenceId=e.paymentAccountReferenceId,u.$broadcast("EXT_ACCOUNT_ADDED",t.addExtPayAcct.accountFields))},function(){m.loadingClass=""})},addExtMoneyMovAcc:function(){m.loadingClass="loading",m.isButtonClicked=!0;var e={accountNumberTLNPI:t.addExtPayAcct.accountFields.accountNumber,abaNumber:t.addExtPayAcct.accountFields.abaNumber,accountUseType:t.addExtPayAcct.accountFields.accountType.accountUseDescription,accountType:t.addExtPayAcct.accountFields.accountType.value,isPrimaryMoneyMovementAccount:t.addExtPayAcct.accountFields.primaryAct};n.saveExternalAccount(e,y.kAddExtBankUrl,"50042").then(function(e){if(m.loadingClass="",m.isButtonClicked=!1,e.easeDisplayError&&e.easeDisplayError.displayMessage)if("1"!==e.easeDisplayError.severity){m.errorText=e.easeDisplayError.displayMessage;var a=document.getElementById("errorText");a.setAttribute("tabIndex","-1"),r(function(){a.focus()})}else m.deleteModal=!0,i.go("customerSettings.settings");else o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"add payment account",level3:"confirmation",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""}),m.errorText="",m.isAccPreferencesState?(m.deleteModal=!0,t.$modalCancel(),s.displayAddExtAccountSuccess()):(t.addExtPayAcct.accountFields.moneyMovementAccountReferenceId=e.moneyMovementAccountReferenceId,u.$broadcast("EXT_ACCOUNT_ADDED",t.addExtPayAcct.accountFields))},function(){m.loadingClass="",m.isButtonClicked=!1})},close:function(){var t=i.current.parent,a=e.isString(t)?i.get(t):t;i.go(a.name)}})}]),t.controller("SuccessExtUMMPaymentCtrl",["$scope","$state","EaseLocalizeService","UmmPaymentFactory","EaseModalService","pubsubService","contentOneFactory","ContentConstant","languagePreferencesFactory",function(t,a,n,c,o,s,r,l,i){var u=this;u.extSuccessContent=r.getContentOneData(l.kAddExternalAccount)[l.kCoreAddExternalAccounts+i.currentLocale.replace("-","_")],n.get("accountSummary").then(function(e){u.i18n=e},function(e){console.log(e)}),e.extend(u,{bankName:c.getBankName(),close:function(){t.$modalCancel(),a.go("customerSettings.settings",{focusflag:!0},{reload:!0})},modalType:"successModalExt",modalClass:"icon-check"})}]),t.controller("editExternalAccountCtrl",["$scope","UmmPaymentFactory","languagePreferencesFactory","$state","close","easeUIModalService","ContentConstant","$rootScope","deleteModalFactory","EASEUtilsFactory",function(e,t,a,n,c,o,s,r,l,i){e.contentData=t.getContentOneData()[s.kCoreAddExternalAccounts+a.currentLocale.replace("-","_")],e.isSettingState="EditExtAccount"===n.current.name,e.tooltipOptions={position:"top",attrs:[{key:"role",value:"presentation"},{key:"aria-labelledby",value:"lblSetPrimaryAct"}]},e.isButtonClicked=!1;var u=i.getEditExtParam();e.primaryExtAct=u.isPrimaryAct,e.isDepositAct=u.isDepositAct,e.bankNameWithNum=u.bankNameWithNum,e.closeModal=function(){c(),t.focusElement("nnUnlink_"+e.bankNameWithNum),n.go("customerSettings.settings")};var d={moneyMovementAccountReferenceId:u.moneyMovActRefId,bankName:u.bankName,paymentAccountReferenceId:u.paymentAccountReferenceId};e.deleteExternalAccount=function(){c(),l.setDeleteData(d),l.confirmModal()},e.isPaymentSaveDisabled=function(){return e.isButtonClicked},e.saveExternalAcc=function(){e.formData={isPrimaryMoneyMovementAccount:editExtAct.primaryExtAct.checked,moneyMovementAccountReferenceId:i.getEditExtParam().moneyMovActRefId},e.isButtonClicked=!0,t.putExternalAccount(e.formData).then(function(t){e.loadingClass="",t.easeDisplayError&&t.easeDisplayError.displayMessage?("1"!==t.easeDisplayError.severity&&(c(),r.$broadcast("error",{msgHeader:t.easeDisplayError.headerMessage?t.easeDisplayError.headerMessage:errorContentData.common_snag_en_US[s.kSnagModalHeader],msgBody:t.easeDisplayError.displayMessage?t.easeDisplayError.displayMessage:errorContentData.common_snag_en_US["core.common.snag.featureoff.short.label"]})),n.go("customerSettings.settings")):e.isSettingState?(c(),n.go("customerSettings.settings",{focusflag:!0},{reload:!0})):r.$broadcast("EXT_ACCOUNT_EDITED",e.editExtAct)},function(){e.loadingClass="",e.isButtonClicked=!1})}}]),t});