define("AlertsModule",["require","angular"],function(e,t){"use strict";function r(e,t){var r={name:"alerts",url:"/alerts",resolve:{contentData:["contentOneFactory","ContentConstant","$q",function(e,t,r){var n=r.defer();return e.initializeContentOneData(t.kAlertPrefs).then(function(e){n.resolve(e)}),n.promise}],featureToggleData:["$q","featureToggleFactory","EaseConstant",function(e,t,r){var n=e.defer();return t.getFeatureToggleDataByGroup(r.features.groups.alerts).then(function(e){n.resolve(e)}),n.promise}],accountSummaryData:["summaryService",function(e){return e.getLobArray().length?e.get():e.set()}],errorContentData:["contentOneFactory","ContentConstant","$q",function(e,t,r){var n=r.defer();return e.initializeContentOneData(t.kSnagUrl).then(function(e){n.resolve(e)},function(){var e=t.kcommon_snag_en_US;n.resolve(e)}),n.promise}],urlChecking:["featureToggleData","$rootScope","EaseConstant","$location","$q","ContentConstant","EASEUtilsFactory","summaryService","errorContentData","accountSummaryData",function(e,t,r,n,a,o,i,s,l,c){var u=s.getLobArray(),d=i.isShowAlerts(e,u),f={};return d||(f.msgHeader=l[o.kCommonSnag+"en_US"]["core.common.snag.modal.header"],f.msgBody=l[o.kCommonSnag+"en_US"]["core.common.snag.modal.featureoff.label"],t.$broadcast("error",f),n.path("/accountSummary")),!0}]},controller:"alertsController",controllerAs:"$ctrl",title:"Alerts",templateUrl:t.get("Alerts")};e.state(r)}var n=t.module("AlertsModule",["EaseProperties","easeAppUtils","ContentProperties"]);return n.config(r),r.inject=["$stateProvider","easeTemplatesProvider"],r.$inject=["$stateProvider","easeTemplatesProvider"],n}),define("AlertsServices",["angular"],function(e){"use strict";function t(e,t,r,n,a,o,i){function s(t){i.$broadcast("error",{msgHeader:t.headerMessage?t.headerMessage:e.getAccSummaryI18().errorSnag.snagHeader,msgBody:t.displayMessage})}function l(e){var r=t.defer();return a.get().then(function(t){var n=o.filter(t.accounts,{category:e});r.resolve(n)},function(e){r.reject(e)}),r.promise}function c(e){return e.substring(e.length-4,e.length)}function u(a,o){var i=t.defer(),s=encodeURIComponent(a.referenceId),l="coaf"===o?"":"&type="+a.accountUseType;return e.clearCustomerActivityHeader(),e.setCustomerActivityHeader("50091"),r.setBaseUrl(n.baseUrl),r.one("customer/alerts/"+o+"?accountReferenceId="+s+l).get().then(function(e){if("coaf"===o&&e.entries&&e.entries.alertSubscription){var t=f(e.entries.alertSubscription);i.resolve(t)}else i.resolve(e)},function(e){i.reject(e)}),i.promise}function d(a,o,i){var s=t.defer(),l=encodeURIComponent(a.referenceId);return e.clearCustomerActivityHeader(),e.setCustomerActivityHeader("50094"),r.setBaseUrl(n.baseUrl),o=o?"/"+o:"",r.one("customer/alerts"+o+"?accountReferenceId="+l).customPOST(i).then(function(e){s.resolve(e)},function(e){s.reject(e)}),s.promise}function f(e){return o.forEach(e,function(e){e.sendToContactPoints&&e.sendToContactPoints.contactPointSummary.length>0?e.subscribedIndicator=!0:e.subscribedIndicator=!1}),e}function y(e){return!!e[0].eligibleContactPoints&&1===o.filter(e[0].eligibleContactPoints.contactPointSummary,{destinationType:"EML"}).length}function m(a){var o=t.defer(),i={alertSubscription:a};e.clearCustomerActivityHeader(),e.setCustomerActivityHeader("50094"),r.setBaseUrl(n.baseUrl);var s=r.all("customer/alerts");return s.post(i).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}return{getAccountsWithAlerts:l,trimAccountNumber:c,getAlerts:u,postAlerts:d,updateAlertSubscriptions:m,showSnag:s,showSendToPrimEmailText:y}}var r=e.module("AlertsModule");return r.factory("alertsFactory",t),t.$inject=["EASEUtilsFactory","$q","Restangular","EaseConstant","summaryService","_","$rootScope"],r}),define("AlertsController",["angular"],function(e){function t(t,r,n,a,o,i,s,l,c,u,d,f,y){function m(e){return o.trimAccountNumber(e)}function p(){u.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"alerts",level4:"edit alerts",level5:"",country:"us",language:"english",system:"ease_web"},lob:"coaf"})}function b(){u.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"alerts",level4:"edit alerts",level5:"",country:"us",language:"english",system:"ease_web"},lob:"card"})}function g(e,t){l.showModal({templateUrl:c.get("Alerts","","editModal"),controller:"editAlertsController",inputs:{alertsContentData:E,coafAccount:e,alertsArray:t}}).then(function(e){e.close.then(function(){S()})})}function A(e){T.disablePencil||(I?(T.disablePencil=!0,o.getAlerts(e,"card").then(function(t){T.disablePencil=!1,U(t,e)},function(){T.disablePencil=!1})):C())}function h(e,t,r){l.showModal({templateUrl:c.get("Alerts","","editCardModal"),controller:"editCardAlertsController",inputs:{alertsContentData:E,cardAccount:e,cardAlertsArray:t,securityAlertsArray:r,viewSecurityAlerts:k,viewOsrAlerts:w}}).then(function(e){e.close.then(function(){S()})})}function v(e){T.disablePencil||(P?(T.disablePencil=!0,o.getAlerts(e,"coaf").then(function(t){T.disablePencil=!1,p(),g(e,t)},function(){T.disablePencil=!1})):C())}function S(){u.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"alerts",level4:"",level5:"",country:"us",language:"english",system:"ease_web"}})}function C(){i.displayErrorHadler(a.defaultErrorMessage.msgHeader,t.common_snag_en_US["core.common.snag.featureoff.short.label"])}var T=this,E=t[s.kCoreAlerts+s.kLanguagePreferences],P=r[a.features.enableEditAlerts],I=r[a.features.enableEditCardAlerts],k=r[a.features.enableDisplaySecurityAlerts]||!1,w=r[a.features.enableDisplayOsrAlerts],D=function(){i.displayErrorHadler(a.defaultErrorMessage.msgHeader,t.common_snag_en_US["core.common.snag.featureoff.short.label"]),n.go("accountSummary")};if(S(),r[a.features.enableDisplayAlerts]){var $=y.getLobArray(),M=d.includes($,"card"),L=d.includes($,"coaf"),F={};r[a.features.enableDisplayCoafAlerts]&&L&&(F.AL="coafArray"),r[a.features.enableDisplayCardAlerts]&&M&&(F.CC="cardArray");var O=Object.getOwnPropertyNames(F);O.length?O.forEach(function(e){o.getAccountsWithAlerts(e).then(function(t){T[F[e]]=t})}):D()}else D();var U=function(e,t){var r=e.easeDisplayError||{};if(!d.isEmpty(r)&&r.displayMessage)"1"===r.severity&&o.showSnag(r);else{var n=[],a=[];e.entries&&e.entries.alertSubscription&&(n=e.entries.alertSubscription),e.entries&&e.entries.securityAlertSubscription&&(a=e.entries.securityAlertSubscription),b(),h(t,n,a)}};e.extend(T,{alertsContentData:E,alertsProfileLabels:t[s.kCoreGlobalDropdown+s.kLanguagePreferences],trimAccountNumber:m,openAlertsModal:v,openCardAlertsModal:A,isShowAlert:f.isAlertsClosed})}function r(t,r,n,a,o,i,s,l){function c(){return t.trimAccountNumber(o.accountNumberTLNPI)}function u(e){n.loadingCSS="loading",i.pubsubTrackAnalytics({name:"update:button"}),t.updateAlertSubscriptions(e).finally(function(){n.close()})}function d(e){return e.replace(/ /g,"").toLowerCase()}var f=l.$on("$stateChangeStart",r);n.$on("$destroy",function(){f()}),e.extend(n,{close:r,content:a,alertAccount:o,trimmedAccountNumber:c,submitAlerts:u,alertsArray:s,loadingCSS:"",generateIdentifier:d})}function n(t,r,n,a,o,i,s,l,c,u,d,f){function y(){var e="-- --"===s.displayName?s.originalProductName:s.displayName;return e+="..."+t.trimAccountNumber(s.accountNumberTLNPI)}function m(){g&&o.pubsubTrackAnalytics({name:"update:button"}),r()}function p(){var e=i?i[0].eligibleContactPoints.contactPointSummary:[],t=u.filter(e,function(e){return"PHN"===e.destinationType&&("ACT"===e.contactPointStatus||"UAS"===e.contactPointStatus)});return!(!t||1!==t.length)&&(n.phone=t[0],!0)}function b(e){return!/onlstr/i.test(e.alertTypeCode)||f}var g=!1;n.phone={};var A=t.showSendToPrimEmailText(i),h=n.$on("updateAlerts",function(e,t){g=!0,n.disableUpdate=t,n.close=n.disableUpdate?function(){}:r,e.stopPropagation()}),v=d.$on("$stateChangeStart",r);n.$on("$destroy",function(){h(),v()}),e.extend(n,{close:r,content:a,cardAlertAccount:s,cardAlertsArray:i,securityAlertsArray:l,getCardAccName:y,loadingCSS:"",disableUpdate:!1,viewSecurityAlerts:c,closeWithPubsub:m,smsEnabled:p(),displayAlert:b,showSendToPrimEmailText:A})}function a(t,r,n,a,i,s){function l(e){p.errorStatus="error",p.errorMsg=e,S=!0}function c(){if("Daily"===p.selectedItem)p.alert.alertFrequency.dailyFrequency.dailyIndicator=!0;else if("Weekly"===p.selectedItem){var e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];p.alert.alertFrequency.weeklyFrequency.dayOfTheWeek=e.indexOf(p.nested.selectedItem)+1}else"Monthly"===p.selectedItem?p.alert.alertFrequency.monthlyFrequency.dayOfTheMonth=p.nested.selectedItem:p.alert.alertFrequency.alertDaysInAdvance.alertDaysInAdvanceValue=p.selectedItem}function u(){1===p.options.length&&"alertDaysInAdvance"===p.options[0].type?p.alert.alertFrequency.alertDaysInAdvance={usableIndicator:!0}:(p.alert.alertFrequency.dailyFrequency={usableIndicator:!0},p.alert.alertFrequency.weeklyFrequency={usableIndicator:!0},p.alert.alertFrequency.monthlyFrequency={usableIndicator:!0})}function d(){n(function(){p.alert=e.copy(m.alert),p.inputValue=m.inputValue,g(m.selectedItem),b(m.nested.selectedItem),p.nested.items=m.nested.items,p.isNestedComponent=m.isNestedComponent,p.emailList=m.emailList},0)}function f(e){if(p.isOsr)return!0;if(p.alert.sendToContactPoints){var r=t.find(p.alert.sendToContactPoints.contactPointSummary,function(t){return t.destinationType===e});return!!r}return!1}function y(){return/ONLSTR/i.test(p.alert.alertTypeCode)?(p.alertTitle=p.content["ease.core.alertsprefs.cc.osralert.title"],!0):(p.alertTitle=p.alert.alertTypeDescription,!1)}var m,p=this,b=function(e){p.nested.tempSelectedItem=e,p.nested.selectedItem=e},g=function(e){p.tempSelectedItem=e,p.selectedItem=e},A=/Email/i;p.selectedFrequency={},p.nested={isOpen:!1,items:[],selected:function(e){e&&p.nested.tempSelectedItem!==e&&(b(e),p.alert.subscribedIndicator&&p.updateAlerts())},data:{id:"alert_nested_id"+p.index,placeholder:"",label:p.content["ease.core.alertsprefs.summarysendday.aria"]}},g(""),p.isNestedComponent=!1,p.populatedNested=function(e){p.isNestedComponent=!0,"Weekly"===e?p.nested.items=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]:"Monthly"===e&&(p.nested.items=t.range(1,29)),b(p.nested.items[0])},p.options=function(){var e=[],t=p.alert.alertFrequency;return Object.getOwnPropertyNames(t).forEach(function(r){if(t[r].usableIndicator){var n=new o(t[r],r);if(e.push(n),n.value)if("alertDaysInAdvanceValue"===n.key)g(n.value);else if(g(n.option),"Weekly"===n.option){p.populatedNested(n.option);var a=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];b(a[n.value-1])}else"Monthly"===n.option&&(p.populatedNested(n.option),b(n.value))}}),e}(),p.isAlertTrigger=p.alert.alertTrigger.usableIndicator||!1,p.inputValue=p.alert.alertTrigger.criteriaValue&&p.alert.alertTrigger.criteriaValue>=0?p.alert.alertTrigger.criteriaValue:void 0,p.isAlertFrequency=!t.isEmpty(p.options),p.isAccountAlert="A"===p.alert.alertType,p.isSecurityAlert="S"===p.alert.alertType,p.disableUpdate=!1,p.ddItems=[],p.emailCheckboxAriaLabel=p.alert.alertTypeDescription+" "+p.content["ease.core.profileprefs.alerts.editmodal.email.label"],p.smsCheckboxAriaLabel=p.alert.alertTypeDescription+" "+p.content["ease.core.profileprefs.alerts.editmodal.sms.label"];var h=function(){p.showEditLink=p.subscribedIndicatorEmail&&p.emailList.length>1&&!p.drawerOpened};p.drawerOpened=!1,p.showMultiEmails=function(){return!p.isOsr&&p.showEditLink},p.isShowDrawer=function(){return!p.isOsr&&p.emailList.length>1};var v;p.onInit=function(){p.isAlertFrequency&&(p.isOpen=!1,1===p.options.length&&"alertDaysInAdvance"===p.options[0].type?p.items=[5,7,10]:p.items=p.options.map(function(e){return e.option}),p.alert.subscribedIndicator||(g(p.items[0]),p.isNestedComponent=!1),p.data={id:"alert_id"+p.index,placeholder:"",label:p.genLabel()}),n(function(){m=e.copy(p)},0),p.isOsr=y(),p.subscribedIndicatorPhone=!!p.alert.subscribedIndicator&&f("PHN"),p.subscribedIndicatorEmail=!!p.alert.subscribedIndicator&&f("EML"),p.alert.sendToContactPoints||(p.alert.sendToContactPoints={contactPointSummary:[]}),p.alert.eligibleContactPoints||(p.alert.eligibleContactPoints={contactPointSummary:[]}),p.eligibleEmails=t.filter(p.alert.eligibleContactPoints.contactPointSummary,{destinationType:"EML"}),p.emailList=e.copy(p.eligibleEmails),p.emailList.forEach(function(e){p.alert.sendToContactPoints.contactPointSummary.forEach(function(t){e.alertDestination===t.alertDestination&&(e.checked=!0)})}),n(function(){m=e.copy(p)},0),v=a.$on("showEditLinkEvt",function(e,t){t.index!==p.index&&p.drawerOpened&&(p.drawerOpened=!1,s[0].dispatchEvent(new CustomEvent("toggle-drawer",{detail:{actionType:"close",drawerId:"drawer"+p.index},bubbles:!0,cancelable:!0}))),h()}),h()},p.selected=function(e){e&&p.tempSelectedItem!==e&&(g(e),b(""),"Weekly"===e||"Monthly"===e?p.populatedNested(e):p.isNestedComponent=!1,p.alert.subscribedIndicator&&p.updateAlerts())},p.genIdForInput=function(){return"inputAlert_"+p.index},p.genLabel=function(){switch(p.alert.alertTypeCode){case"TRXABX":return p.content["ease.core.alertsprefs.hightrans.aria"];case"BALABX":return p.content["ease.core.alertsprefs.highbal.aria"];case"AVCRLX":return p.content["ease.core.alertsprefs.closetolimit.aria"];case"PAYDUE":return p.content["ease.core.alertsprefs.paymentdue.aria"];case"BALSUM":return p.content["ease.core.alertsprefs.summaryfreq.aria"]}};var S=!1;p.resetErrorStatus=function(e){a.$evalAsync(function(){p.errorStatus="",p.errorMsg="",e||p.alert.subscribedIndicator&&!p.inputValue&&(p.inputValue=p.alert.alertTrigger.criteriaValue&&p.alert.alertTrigger.criteriaValue>0?p.alert.alertTrigger.criteriaValue:void 0)})},p.checkBeforeResettingErrorStatus=function(){S?S=!1:p.resetErrorStatus()};var C=function(n){var o=n.easeDisplayError||{};!t.isEmpty(o)&&o.displayMessage?("1"===o.severity?r.showSnag(o):"2"===o.severity&&l(o.displayMessage),d()):m=e.copy(p),a.disableUpdate=!1,a.$emit("updateAlerts",!1)},T=function(e){p.emailList.forEach(function(t){t.checked=e})};p.emailCheckBoxClickHandler=function(e,t){p.subscribedIndicatorEmail=p.getSendToEmailList().length>0,p.updateAlerts(t),e.stopPropagation()},p.checkBoxHandler=function(e,t){return p.disableUpdate&&e.preventDefault(),p.isAlertTrigger&&p["subscribedIndicator"+t]&&!p.inputValue?(l(p.content["ease.core.profileprefs.alerts.editmodal.missingvalue.error"]),void(p["subscribedIndicator"+t]=!1)):(A.test(t)&&(p.openDrawer(p.index,!p["subscribedIndicator"+t]),T(p["subscribedIndicator"+t])),void p.updateAlerts(t))};var E=function(){return t.filter(p.alert.sendToContactPoints.contactPointSummary,function(e){return!/EML/i.test(e.destinationType)})};p.updateAlerts=function(e){e&&!p.isOsr?p["subscribedIndicator"+e]?(p.alert.subscribedIndicator=!0,A.test(e)?(p.alert.sendToContactPoints.contactPointSummary=E(),p.alert.sendToContactPoints.contactPointSummary=p.alert.sendToContactPoints.contactPointSummary.concat(p.getSendToEmailList())):p.alert.sendToContactPoints.contactPointSummary.push(p["get"+e])):(A.test(e)?p.alert.sendToContactPoints.contactPointSummary=E():p.alert.sendToContactPoints.contactPointSummary=t.filter(p.alert.sendToContactPoints.contactPointSummary,function(t){return t.alertDestination!==p["get"+e].alertDestination}),p.alert.subscribedIndicator=p.alert.sendToContactPoints.contactPointSummary.length>0):p.isOsr&&(p.alert.subscribedIndicator=p.subscribedIndicatorEmail),p.isAlertFrequency&&(u(),(e&&p["subscribedIndicator"+e]||p.alert.subscribedIndicator)&&(c(),a.disableUpdate=!0)),a.$emit("updateAlerts",!0),a.disableUpdate=!0,r.postAlerts(p.account,"card",p.alert).then(C,function(){a.disableUpdate=!1,d()})},p.openDrawer=function(e,t){i.$broadcast("showEditLinkEvt",{index:e}),t||(p.drawerOpened=!0,s[0].dispatchEvent(new CustomEvent("toggle-drawer",{detail:{actionType:"open",drawerId:"drawer"+e},bubbles:!0,cancelable:!0})),h())},p.getSendToEmailList=function(){return t.filter(p.emailList,{checked:!0})},p.validateInput=function(){p.errorStatus="",p.errorMsg="",p.alert.subscribedIndicator?p.inputValue?p.alert.alertTrigger.criteriaValue!==p.inputValue&&(p.alert.alertTrigger.criteriaValue=p.inputValue,p.updateAlerts()):n(function(){l(p.content["ease.core.profileprefs.alerts.editmodal.missingvalue.error"])},0):p.alert.alertTrigger.criteriaValue=p.inputValue},a.$on("$destroy",function(){v()}),p.onInit()}function o(e,t){this.type=t,this.value=void 0,this.key=void 0,this.init=function(){switch(t){case"alertDaysInAdvance":this.key="alertDaysInAdvanceValue",this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"dailyFrequency":this.key="dailyIndicator",this.option="Daily",this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"weeklyFrequency":this.key="dayOfTheWeek",this.option="Weekly",this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"monthlyFrequency":this.key="dayOfTheMonth",this.option="Monthly",this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0}},this.init()}e.module("AlertsModule").controller("alertsController",t).controller("editAlertsController",r).controller("editCardAlertsController",n).controller("alertRowController",a),t.$inject=["contentData","featureToggleData","$state","EaseConstant","alertsFactory","easeExceptionsService","ContentConstant","easeUIModalService","easeTemplates","pubsubService","_","EASEUtilsFactory","summaryService"],r.$inject=["alertsFactory","close","$scope","alertsContentData","coafAccount","pubsubService","alertsArray","$rootScope"],n.$inject=["alertsFactory","close","$scope","alertsContentData","pubsubService","cardAlertsArray","cardAccount","securityAlertsArray","viewSecurityAlerts","_","$rootScope","viewOsrAlerts"],a.$inject=["_","alertsFactory","$timeout","$scope","$rootScope","$element"]}),define("AlertsDirectives",["angular"],function(e){"use strict";function t(e){return{restrict:"A",link:function(t,r,n){t.$watch(n.focusCardAlertEmailList,function(t){t&&e(function(){r[0].focus()},100)})}}}var r=e.module("AlertsModule");r.directive("alertRow",[function(){return{restrict:"E",templateUrl:"/ease-ui/dist/features/Alerts/html/Alert-fields.html",bindToController:!0,controller:"alertRowController",controllerAs:"rowCtrl",scope:{alert:"=",index:"@idx",account:"=",content:"=",getPhone:"=",smsEnabled:"=",totalAlerts:"@"}}}]),t.$inject=["$timeout"],r.directive("focusCardAlertEmailList",t),r.directive("validateAlertInput",function(){return{restrict:"A",require:"^^alertRow",link:function(t,r,n,a){var o=e.element(r.find("input"));o.on("blur",function(){a.validateInput()})}}}),r.directive("parentResetErrorStatus",function(){return{restrict:"A",controller:function(){this.resetErrorDirectiveElements=[]}}}),r.directive("resetAlertErrorStatus",["$timeout","_","$document",function(t,r,n){return{restrict:"A",require:"^^parentResetErrorStatus",link:{pre:function(e,t,r,n){n.resetErrorDirectiveElements.push(t[0])},post:function(a,o,i,s){t(function(){var t=n.find("ease-input"),i=s.resetErrorDirectiveElements;r.forEach(t,function(t){function r(){"checkbox"===o[0].type?n():s()}function n(){(u!==o.controller("alertRow")||u.inputValue||u.alert.subscribedIndicator)&&u.resetErrorStatus()}function s(){o.find("input")[0]===c.find("input")[0]?u.resetErrorStatus(!0):u.checkBeforeResettingErrorStatus()}function l(e){var t=e.keyCode||e.which||e.charCode;if(16!==t)if(o.find("input")[0]===c.find("input")[0]){if(8===t||9===t||16===t)return}else d===f-1&&!e.shiftKey&&9===t||d===f+1&&e.shiftKey&&9===t?u.resetErrorStatus(!0):u.resetErrorStatus()}var c=e.element(t),u=c.controller("alertRow"),d=i.indexOf(o[0]),f=i.indexOf(c[0]);o.on("click",r),o.on("keydown",l),a.$on("$destroy",function(){o.off("click",r),o.off("keydown",l)})})})}}}}])}),define("AlertsBundle",["AlertsModule","AlertsServices","AlertsController","AlertsDirectives"],function(){}),require(["AlertsBundle"]);