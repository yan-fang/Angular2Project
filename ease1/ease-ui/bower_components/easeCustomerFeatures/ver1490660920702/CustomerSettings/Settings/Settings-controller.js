define(["angular"],function(e){function n(n,t,a,o,r,s,c,l,u,i,g,m,d,y,f,v,b,p){function A(e){return e&&e.easeDisplayError&&"203"===e.easeDisplayError.errorIdString?(D=e.easeDisplayError.displayMessage,!0):void 0}var S=this,M=c.getFeatureToggleData(),D="";m.focusflag||t.getFocusForEscapeHatch(),l["ease.core.settings.account.edit.arialabel.label"]="Edit",l["ease.core.settings.account.delete.arialabel.label"]="Delete",S.messageOptions={iconColor:"#ff0000",isCloseIcon:!0,alertIcon:!0,globalElementId:"globalMessageHolderSettings",alertIconAria:"Alert Icon",closeIconAria:"Close Icon",closeAlert:!0},S.isExternalAccDisplay=M[n.features.addExternalAccountFeature],S.focusflag=m.focusflag,g.initializeContentOneData(u.kAddExternalAccount,null,v.currentLocale),e.extend(S,{contentDataSettings:l,errorContentData:d,isMoneyMovementOn:b[n.features.combinedmoneymovementAccounts],isRetrieveMoneyMovementToggledOn:b[n.features.combinedmoneymovementAccounts]&&b[n.features.retrieveMoneyMovementAccounts],moneyMovFeatToggleData:b,displayAccounts:function(e,t){function a(e){return function(n){return n&&n.displayAccountNumber&&n.displayAccountNumber===e}}S.accounts=e.accounts;var o=t&&t.entries;if(o)for(var r in S.accounts){var s="";S.accounts[r].accountNumberTLNPI&&(s=o.filter(a(S.accounts[r].accountNumberTLNPI.slice(-4)))),s.length>0&&(S.accounts[r].isEligibleForPayment=!0,S.accounts[r].moneyMovementAccountReferenceId=s[0].moneyMovementAccountReferenceId,S.accounts[r].isPrimaryMoneyMovementAccount=s[0].isPrimaryMoneyMovementAccount)}S.enableNickname=e.enableNickname,S.isnicknamedisplay=M[n.features.nickNameFeature],S.extdeleteDisplay=M[n.features.manageExternalDelAccountFeature]},displayAddAccount:function(){M&&!M[n.features.manageExternalAccountFeature]?y.$broadcast("error",{msgHeader:d.common_snag_en_US[u.kSnagModalHeader],msgBody:d.common_snag_en_US[u.kSnagFeatureOffLabel]}):i.go("AddExtAccount")},displayExtAccountCount:function(e){function n(e){return e.isLinkedAccount?!1:(t++,!0)}var t=0,a=e?e.filter(n):"";return S.retrievePaymentAccounts=a,t},showDefaultPrimary:function(){return M[n.features.combinedmoneymovementAccounts]&&M[n.features.defaultPaymentAccount]},enableShowLanguage:M[n.features.enableShowLanguage],enableEditLanguage:M[n.features.enableEditLanguage],editLanguage:function(){S.enableEditLanguage?i.go("customerSettings.settings.language"):S.openFeatureUnavailable()},getLanguage:v.currentLocaleText,openFeatureUnavailable:function(){y.$broadcast("error",{msgHeader:S.errorContentData&&S.errorContentData.common_snag_en_US?S.errorContentData.common_snag_en_US[u.kSnagModalHeader]:"",msgBody:S.errorContentData&&S.errorContentData.common_snag_en_US?S.errorContentData.common_snag_en_US[u.kSnagFeatureOffLabel]:""})}}),(!S.isMoneyMovementOn&&A(s)||S.isMoneyMovementOn&&(A(s.internal)||A(s.external)))&&(S.messageOptions.alertContent=D),S.internalAccounts=S.isMoneyMovementOn&&s?s.internal:void 0,S.displayAccounts(r,S.internalAccounts),s=S.isMoneyMovementOn&&s?s.external:s,s&&s.entries&&(S.retrievePaymentAccounts=s.entries,S.retrievePaymentAccounts.sort(function(e,n){return new Date(e.accountAddedDate)-new Date(n.accountAddedDate)})),o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"settings",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:f.getLobArray().join(" | ")}),S.focusflag===!0&&0===S.displayExtAccountCount(S.retrievePaymentAccounts)&&a(function(){p[0].getElementById("noActslabel").focus()},1e3)}function t(n,t,a,o){var r=this;e.extend(r,{content:a.getContentData(),bankName:a.getDeleteData().bankName,close:function(e){e&&o.pubsubTrackAnalytics({name:"Remove Payment Account:View Account:link"}),n.$modalCancel(),t.go("customerSettings.settings",{focusflag:!0},{reload:!0})},modalType:"successModalExt",modalClass:"icon-check"})}function a(n,t,a,o,r,s,c){var l=this;a.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"remove external account",level3:"",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""}),e.extend(l,{content:r.getContentData(),bankName:r.getDeleteData().bankName,contentMsg:r.getContentArticleMsg(),close:function(){a.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"settings",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:s.getLobArray().join(" | ")}),t.$modalCancel(),c.go("customerSettings.settings")},confirm:function(){l.loadingClass="loading";var e={paymentAccountReferenceId:encodeURIComponent(r.getDeleteData().paymentAccountReferenceId),moneyMovementAccountReferenceId:encodeURIComponent(r.getDeleteData().moneyMovActRefId)};r.deleteExternalAccount(e).then(function(e){l.loadingClass="",e.easeDisplayError&&e.easeDisplayError.displayMessage?(t.$modalCancel(),"1"!==e.easeDisplayError.severity&&n.$broadcast("error",{msgHeader:e.easeDisplayError.headerMessage?e.easeDisplayError.headerMessage:o.getAccSummaryI18().errorSnag.snagHeader,msgBody:e.easeDisplayError.displayMessage?e.easeDisplayError.displayMessage:o.getAccSummaryI18().errorSnag.snagBody}),c.go("customerSettings.settings")):e&&(a.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"remove external account",level3:"confirmation",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""}),t.$modalCancel(),r.successModal())},function(){l.loadingClass=""})},modalType:"confirmModalExt",modalClass:"icon-check"})}function o(e,n,t){n.openEditLanguageModal(t)}function r(e,n,t,a,o,r,s,c,l,u,i,g){e.language=r.currentLocale,e.kEnglishLocale=c.kEnglishLocale,e.kSpanishLocale=c.kSpanishLocale,e.close=function(){o.go("customerSettings.settings"),t.updatePubSub()},e.content=a,e.editLanguage=function(o){o!==e.kEnglishLocale&&o!==r.currentLocale?(n(),t.openConfirmLanguageModal(a)):(g.pubsubTrackAnalytics({name:"save:button"}),e.saveLanguage(o))},e.saveSpanish=function(){g.pubsubTrackAnalytics({name:"spanish:button"}),e.saveLanguage(e.kSpanishLocale)},e.cancelSpanish=function(){g.pubsubTrackAnalytics({name:"english:link"}),e.close()};var m=e.$on("$stateChangeStart",n);e.$on("$destroy",function(){m()}),e.saveLanguage=function(n){n!==r.currentLocale?t.changeLanguagePreferences(n).then(function(t){var a=t.easeDisplayError;a&&a.displayMessage?(e.close(),i.$broadcast("error",{msgHeader:a.headerMessage?a.headerMessage:u.getAccSummaryI18().errorSnag.snagHeader,msgBody:a.displayMessage?a.displayMessage:u.getAccSummaryI18().errorSnag.snagBody})):(r.setLanguagePreferences(n),e.close(),l(function(){s.location.reload()},100))}):e.close()}}return n.$inject=["EaseConstant","EASEUtilsFactory","$timeout","pubsubService","summaryDataFS","retrievePaymentAccounts","featureToggleFactory","contentDataSettings","ContentConstant","$state","contentOneFactory","$stateParams","errorContentData","$rootScope","summaryService","languagePreferencesFactory","moneyMovementFeatureToggleData","$document"],t.$inject=["$scope","$state","deleteModalFactory","pubsubService"],a.$inject=["$rootScope","$scope","pubsubService","EASEUtilsFactory","deleteModalFactory","summaryService","$state"],o.$inject=["$scope","settingsFactory","contentData"],r.$inject=["$scope","close","settingsFactory","contentData","$state","languagePreferencesFactory","$window","EaseConstant","$timeout","EASEUtilsFactory","$rootScope","pubsubService"],e.module("settingsModule").controller("SettingsController",n).controller("SuccessdelExtPayAcctCtrl",t).controller("ExtAccDeleteConfirmCtrl",a).controller("languagePrefController",o).controller("SettingsLanguageModalCtrl",r)});