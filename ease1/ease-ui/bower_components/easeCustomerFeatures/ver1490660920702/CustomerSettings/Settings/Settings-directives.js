define(["angular"],function(e){function a(e,a,n,o,c,r,i,s){return{restrict:"A",replace:!0,scope:{nickName:"=nickName",enableNickname:"=",contentDataSettings:"=",contentDataError:"="},templateUrl:a.get("Settings","","nickName"),link:function(m){var l,u=n.getFeatureToggleData(),d=u[e.features.nickNameFeature];if(m.nickName.accountNickname?l=m.nickName.accountNickname:m.enableNickname&&(l="-- --"),d){var y=["ST"];m.enableNickname?m.nickName.productId&&-1!==y.indexOf(m.nickName.productId.substr(0,2))?(d=!1,l=m.nickName.originalProductName):d=!0:d=!1}m.formData={primaryData:m.nickName.originalProductName+" ... "+m.nickName.accountNumberTLNPI.substring(m.nickName.accountNumberTLNPI.length-4,m.nickName.accountNumberTLNPI.length),accountNicknameContent:m.contentDataSettings,nicknameValue:l,isnicknamedisplay:d,contentDataError:m.contentDataError,accountNumberTLNPI:m.nickName.accountNumberTLNPI,category:m.nickName.category,subCategory:m.nickName.subCategory,isEligibleForPayment:m.nickName.isEligibleForPayment,isPrimaryMoneyMovementAccount:m.nickName.isPrimaryMoneyMovementAccount,moneyMovementAccountReferenceId:m.nickName.moneyMovementAccountReferenceId},m.openNickNameModal=function(e){e.formData.isnicknamedisplay?r.showModal({templateUrl:a.get("Settings","","updateNickName"),inputs:{accountData:e},controller:t}).then(function(e){e.close.then(function(){i.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"settings",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:s.getLobArray().join(" | ")})})}):o.$broadcast("error",{msgHeader:e.formData.contentDataError.common_snag_en_US[c.kSnagModalHeader],msgBody:e.formData.contentDataError.common_snag_en_US[c.kSnagFeatureOffLabel]})}}}}function t(e,a,t,n,o,c,r,i,s,m,l){function u(){c.updateAccountNickName({accountReferenceId:encodeURIComponent(o.nickName.referenceId),accountNickname:"-- --"===a.formData.nicknameValue?"":a.formData.nicknameValue}).then(function(e){if(a.loading="",!e)throw y&&a.closeNickNameModal(),s.createEaseException({module:"settingsModule.directive","function":"updateNickName"});o.formData.nicknameValue=a.formData.nicknameValue;var n=r.getSummaryData(),c=a.formData;n.accounts.forEach(function(e){e.accountNumberTLNPI===a.formData.accountNumberTLNPI&&(e.accountNickname=c.nicknameValue,e.isPrimaryMoneyMovementAccount=c.isPrimaryMoneyMovementAccount)}),r.setSummaryData(n),t.pubsubTrackAnalytics({name:"save nickname:button"}),y&&a.closeNickNameModal(),l[0].getElementById("nnEdit_"+a.formData.primaryData).focus()},function(e){throw y&&a.closeNickNameModal(),s.createEaseException({module:"settingsModule.directive","function":"updateNickName",message:e.statusMessage,cause:e})})}function d(){var t={isPrimaryMoneyMovementAccount:a.formData.isPrimaryMoneyMovementAccount,moneyMovementAccountReferenceId:a.formData.moneyMovementAccountReferenceId};c.putExternalAccount(t).then(function(t){a.loadingClass="",t.easeDisplayError&&t.easeDisplayError.displayMessage?"1"!==t.easeDisplayError.severity&&(y&&a.closeNickNameModal(),e.$broadcast("error",{msgHeader:t.easeDisplayError.headerMessage?t.easeDisplayError.headerMessage:o.contentDataError.common_snag_en_US["core.common.snag.modal.header"],msgBody:t.easeDisplayError.displayMessage?t.easeDisplayError.displayMessage:o.contentDataError.common_snag_en_US["core.common.snag.featureoff.short.label"]})):m.go(m.current,{},{reload:!0})},function(e){throw y&&a.closeNickNameModal(),s.createEaseException({module:"settingsModule.directive","function":"updateNickName",message:e.statusMessage,cause:e})})}t.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"customer profile preferences",level3:"settings",level4:"edit account nickname",level5:"",country:"us",language:"english",system:"ease_web"},lob:i.getLobFromProduct(o.formData)}),a.tooltipOptions={position:"top",attrs:[{key:"role",value:"presentation"},{key:"aria-labelledby",value:"lblSetInternalPrimaryAct"}]};var y=!0;a.formData={primaryData:o.formData.primaryData,nicknameValue:"-- --"===o.formData.nicknameValue?"":o.formData.nicknameValue,contentDataSettings:o.contentDataSettings,primaryAcctNum:o.formData.primaryData,contentDataError:o.contentDataError,accountNumberTLNPI:o.formData.accountNumberTLNPI,isEligibleForPayment:o.formData.isEligibleForPayment,isPrimaryMoneyMovementAccount:o.formData.isPrimaryMoneyMovementAccount,moneyMovementAccountReferenceId:o.formData.moneyMovementAccountReferenceId},a.closeNickNameModal=function(){n(),y=!1,l[0].getElementById("nnEdit_"+a.formData.primaryData).focus()},a.editAccount=function(){a.loading="loading",a.formData.nicknameValue=""===a.formData.nicknameValue?"-- --":a.formData.nicknameValue;var e=o.formData.nicknameValue!==a.formData.nicknameValue?!0:!1,t=o.formData.isPrimaryMoneyMovementAccount!==a.formData.isPrimaryMoneyMovementAccount?!0:!1;e&&u(),t&&d(),e||t||(a.loading="",a.closeNickNameModal())};var g=e.$on("$stateChangeStart",n);a.$on("$destroy",function(){g()})}function n(a){return{restrict:"A",replace:!0,scope:{closeNickNameModal:"&"},link:function(t,n){function o(e){var a=/^[a-z0-9A-Z.',\- ]*$/;a.test(e.target.value)?r():c()}function c(){i.addClass("error-label"),s.addClass("errorText"),m[0].disabled=!0}function r(){i.removeClass("error-label"),s.removeClass("errorText"),m[0].disabled=!1}var i=e.element(n[0].querySelector("#txtSecondary")),s=e.element(n[0].querySelector("#nnErrorMsg")),m=e.element(n[0].querySelector("#editNickNameBtn"));i.on("keyup",function(e){o(e);var a=e.which||e.keyCode||e.charCode;13===a&&(m[0].disabled||m.triggerHandler("click"))}),["keypress","change","blur","focus","input","mouseup"].forEach(function(e){i.on(e,function(e){o(e)})});var l=a.$on("logout",function(){t.closeNickNameModal()});t.$on("$destroy",l)}}}function o(e,a,t,n,o,c,r){return{restrict:"AE",replace:!0,scope:{modal:"=",contentData:"=",extdeleteDisplay:"=",focusflag:"=",isRetrieveMoneyMovementToggledOn:"=",moneyMovFeatToggleData:"="},templateUrl:e.get("Settings","","externalAccounts"),link:function(e,n,i){if(e.displayPayments=!1,e.displayTransfers=!1,e.iconObj={},e.kPermission=e.isRetrieveMoneyMovementToggledOn?"moneyMovementAccountPermissions":"permissionName",e.$parent.$first&&e.focusflag&&(n.find("span")[0].focus(),e.focusflag=!1),e.unLinkImg=a.customerSettings.accountPreference.baseImageLocation+"unLink.png",e.displayAccountDetails=!1,"externalAccount"===i.type&&e.modal&&!e.modal.isLinkedAccount){e.isPrimaryAccount=e.modal.isPrimaryMoneyMovementAccount,e.primaryExternalAcctName=e.modal.bankName+" ... "+e.modal.displayAccountNumber,e.modal.accountType&&(e.secondryExternalAcctTypeData=e.contentData["ease.core.settings.account.external.accttype.label"]+" "+e.modal.accountType.toLowerCase().replace("_"," ")),!e.modal[e.kPermission]||e.modal[e.kPermission]!==a.customerSettings.accountPreference.kPermissionNamePayments&&e.modal[e.kPermission]!==a.customerSettings.accountPreference.kPermissionNamePaymentsTransfers||(e.displayPayments=!0,e.secondryExternalAcctPaymentData=e.contentData["ease.core.settings.account.paymentstatus.label"]+": "+e.contentData["ease.core.settings.account.availablestatus.label"]),!e.modal[e.kPermission]||e.modal[e.kPermission]!==a.customerSettings.accountPreference.kPermissionNameTransfers&&e.modal[e.kPermission]!==a.customerSettings.accountPreference.kPermissionNamePaymentsTransfers||(e.displayTransfers=!0,e.secondryExternalAcctTransferData=e.contentData["ease.core.settings.account.transferstatus.label"]+": "+e.contentData["ease.core.settings.account.availablestatus.label"]),e.modal[e.kPermission]&&e.modal[e.kPermission]===a.customerSettings.accountPreference.kPermissionName&&(e.secondryExternalAcctPaymentData=e.contentData["ease.core.settings.account.external.payment.label"]+" "+e.contentData["ease.core.settings.account.external.payment.value.text"]),e.displayAccountDetails=!0;"nnSecondary_"+e.primaryExternalAcctName,document.getElementById("secondaryClick");e.moneyMovFeatToggleData[a.features.combinedmoneymovementAccounts]&&e.moneyMovFeatToggleData[a.features.editExternalAccountFeature]?(e.iconObj.iconClass="icon-pencil",e.iconObj.ariaLabel=e.contentData["ease.core.settings.account.edit.arialabel.label"]+e.primaryExternalAcctName):!e.moneyMovFeatToggleData[a.features.combinedmoneymovementAccounts]&&e.moneyMovFeatToggleData[a.features.manageExternalDelAccountFeature]&&(e.iconObj.iconClass="icon-trash",e.iconObj.ariaLabel=e.contentData["ease.core.settings.account.delete.arialabel.label"]+e.primaryExternalAcctName)}e.manageClkEvt=function(){var n;e.moneyMovFeatToggleData[a.features.combinedmoneymovementAccounts]&&e.moneyMovFeatToggleData[a.features.editExternalAccountFeature]?(n=e.modal.bankName+" ... "+e.modal.displayAccountNumber,r.setEditExtParam({moneyMovActRefId:e.modal.moneyMovementAccountReferenceId,isPrimaryAct:e.modal.isPrimaryMoneyMovementAccount,bankName:e.modal.bankName,isDepositAct:e.displayTransfers,bankNameWithNum:n}),c.go("EditExtAccount")):!e.moneyMovFeatToggleData[a.features.combinedmoneymovementAccounts]&&e.moneyMovFeatToggleData[a.features.manageExternalDelAccountFeature]?(t.setDeleteData(e.modal),t.confirmModal()):o.$broadcast("error",{msgHeader:errorContentData.common_snag_en_US[ContentConstant.kSnagModalHeader],msgBody:errorContentData.common_snag_en_US[ContentConstant.kSnagFeatureOffLabel]})}}}}function c(e,a){return{restrict:"A",link:function(t,n,o){function c(){a.elementTriggeringModal=i}function r(e){var t=e.which||e.charCode;(13===t||32===t)&&(a.elementTriggeringModal=i)}var i=o.id;n.on("click",c),n.on("keypress",r);var s=e.$on("returningToSettingsPage",function(){a.elementTriggeringModal&&a.elementTriggeringModal===i&&n[0].focus()});t.$on("$destroy",function(){s(),n.off("click",c),n.off("keypress",r)})}}}return a.$inject=["EaseConstant","easeCoreTemplates","featureToggleFactory","$rootScope","ContentConstant","easeUIModalService","pubsubService","summaryService"],t.$inject=["$rootScope","$scope","pubsubService","close","accountData","settingsFactory","EASEUtilsFactory","summaryService","easeExceptionsService","$state","$document"],n.$inject=["$rootScope"],o.$inject=["easeCoreTemplates","EaseConstant","deleteModalFactory","settingsFactory","$rootScope","$state","EASEUtilsFactory"],c.$inject=["$rootScope","settingsFactory"],e.module("settingsModule").directive("nickName",a).directive("nickNameModal",n).directive("accountPreferences",o).directive("focusOnSettingsModalClose",c)});