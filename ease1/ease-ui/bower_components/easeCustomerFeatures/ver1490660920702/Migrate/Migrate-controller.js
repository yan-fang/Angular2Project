define(["angular"],function(e){function a(a,i,r,o,t,n,l,s,m,p,b,c,h,u,d,g){var P=this;i.setProfileprefContentData(o),i.setErrorContentData(p),P.isMigrateFeatureEnabled=s[m.features.enableMigrateFeature],i.findPrimaryEmail(t),a.newPhoneNumberObj={isPrimary:!1,phoneNumber:"",phoneType:"mobile",hasTcpaConsent:!1},a.pubsubObjMigration={taxonomy:{level1:"ease",level2:"migration",level3:"",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:""},d.pubsubTrackAnalytics(a.pubsubObjMigration);var y=a.newPhoneNumberObj.phoneType;a.numberLabel=i.getNumberLabel(y);var C=b.$on("addEmail",function(e,a){P.emailList=a}),f=b.$on("updatePhoneNumbers",function(e,a){if(P.checkIfCloseClicked=a.checkIfCloseClicked,P.obj=a.phoneObj,P.checkIfCloseClicked||isNaN(parseInt(P.obj.phoneNumber.replace(/[\(\)\.\-\ ]/g,""),10))){var i=P.phoneObj.selectedPhoneCriteria[P.updatedPhoneType].checkSelectSequence[0];if(i){var o={selectedPhoneCriteria:P.phoneObj.selectedPhoneCriteria,selectPhoneType:P.updatedPhoneType,phoneNumber:i.label,hasTcpaConsent:i.tcpaFlag,isPrimary:i.primaryFlag,phonePrimaryDisable:i.phonePrimaryDisable,contentDataMigration:r,source:i.source};h.setSelectPhoneCriteria(o)}}else{var t={label:P.obj.phoneNumber,phoneType:P.obj.phoneType,primaryFlag:P.obj.isPrimary,phonePrimaryDisable:!1,tcpaFlag:P.obj.hasTcpaConsent,tcpaMsg:h.getTcpaMsg(P.obj.hasTcpaConsent,r)},n=P.obj.phoneType+"Data";h.changeDataHolder(t,P.phoneTypes,P.phoneObj,r,P[n]),P.setPrimaryPhone()}});a.$on("$destroy",function(){f(),C()}),e.extend(P,{required:!1,checkIfCloseClicked:!1,itemInDropdown:"",isMobileOpen:!1,isWorkOpen:!1,isHomeOpen:!1,isPrimarySet:!1,itemsInfo:{},loading:"",enableEditPhone:l[m.features.enableEditPhone],enableEditEmail:l[m.features.enableEditEmail],phoneNumberData:n,contentDataMigration:r,emailList:t,isDisplayPhoneEnabled:P.isMigrateFeatureEnabled&&s[m.features.enablePhoneOnMigrate],isDisplayEmailEnabled:P.isMigrateFeatureEnabled&&s[m.features.enableEmailOnMigrate]&&t,migrationErrorForDefaultPrimary:c.kMigrationErrorMessageForDefaultPrimary,mobileItems:[],homeItems:[],workItems:[],isButtonClicked:!1,phoneObj:{dataHolder:{mobile:[],work:[],home:[]},selectedPhoneCriteria:{mobile:{label:"",primaryFlag:!1,phonePrimaryDisable:!1,tcpaFlag:"",tcpaMsg:"",checkSelectSequence:[]},home:{label:"",primaryFlag:!1,phonePrimaryDisable:!1,tcpaFlag:"",tcpaMsg:"",checkSelectSequence:[]},work:{label:"",primaryFlag:!1,phonePrimaryDisable:!1,tcpaFlag:"",tcpaMsg:"",checkSelectSequence:[]}}},mobileData:{id:"Mobile",placeholder:r["ease.core.migrationacctsetup.selectnum.label"],errorMessage:"You must select a Number"},workData:{id:"Work",placeholder:r["ease.core.migrationacctsetup.selectnum.label"],errorMessage:"You must select a Number"},homeData:{id:"Home",placeholder:r["ease.core.migrationacctsetup.selectnum.label"],errorMessage:"You must select a Number"},phoneTypes:["mobile","home","work"],primaryEmailObject:function(){var e,a;return P.emailList.editFlow?(e=P.emailList.email,a=i.getPrimaryEmail(),a.emailAddress=e,a):i.getPrimaryEmail()},isPrimaryEmailInvalid:function(){return i.isPrimaryEmailInvalid()},displayEmailText:function(){return P.emailList.editFlow?P.emailList.email:P.isPrimaryEmailInvalid()?"Invalid email address on file":P.primaryEmailObject().emailAddress},openFeatureUnavailable:function(){i.openFeatureUnavailable()},editPhoneNumber:function(e,o){if(P.enableEditPhone){if(o===r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]){P.updatedPhoneType=e;var t=r["ease.core.migrationacctsetup.migration."+P.updatedPhoneType+".addmodal.title.label"];h.editPhoneNumber(n,e,P.phoneObj,i,P.phoneNumberData,a.pubsubObjMigration,t)}}else P.openFeatureUnavailable()},editPhoneNumberKeyDown:function(e,o,t){var l=P.itemInDropdown.label;if(o&&(l=o),P.enableEditPhone){if(l===r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]&&13===t.keyCode){P.updatedPhoneType=e;var s=r["ease.core.migrationacctsetup.migration."+P.updatedPhoneType+".addmodal.title.label"];h.editPhoneNumber(n,e,P.phoneObj,i,P.phoneNumberData,a.pubsubObjMigration,s)}}else P.openFeatureUnavailable()},editEmail:function(e){if(P.enableEditEmail){e.primaryIndicator=!0,P.isPrimaryEmailInvalid()&&(e.emailAddress="");var r={taxonomy:{level1:"ease",level2:"migration",level3:"",level4:"edit email",level5:"",country:"us",language:"english",system:"ease_web"},lob:""};i.editEmailModal(e,r,a.pubsubObjMigration)}else P.openFeatureUnavailable()},openEditTcpaSettingsModal:function(e){var r={taxonomy:{level1:"ease",level2:"migration",level3:"",level4:"update "+e+" TCPA",level5:"",country:"us",language:"english",system:"ease_web"},lob:""};P.updatedPhoneType=e;var o={updatedPhoneType:e,profileInfoFactory:i,phoneObj:P.phoneObj,pubsubObjMigration:a.pubsubObjMigration,pubsubObj:r};h.openEditTcpaSettingsModal(o)},setPrimaryPhone:function(){P.mobilePri=P.phoneObj.selectedPhoneCriteria.mobile.primaryFlag,P.workPri=P.phoneObj.selectedPhoneCriteria.work.primaryFlag,P.homePri=P.phoneObj.selectedPhoneCriteria.home.primaryFlag,P.isPrimarySet||(P.isPrimarySet=!0,P.mobilePri||P.workPri||P.homePri||(P.phoneObj.selectedPhoneCriteria.mobile.phonePrimaryDisable?P.phoneObj.selectedPhoneCriteria.work.phonePrimaryDisable?P.phoneObj.selectedPhoneCriteria.home.phonePrimaryDisable||(P.homePri=P.phoneObj.selectedPhoneCriteria.home.primaryFlag=!0):P.workPri=P.phoneObj.selectedPhoneCriteria.work.primaryFlag=!0:P.mobilePri=P.phoneObj.selectedPhoneCriteria.mobile.primaryFlag=!0))},getPhoneNumber:function(e,a){h.getPhoneNumber(e,a,P.phoneObj,r,P.checkIfCloseClicked),P.setPrimaryPhone()},tabSelectedPhoneNum:function(e,a,i){13!==e.which&&13!==e.keyCode||a.label!==r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]||P.editPhoneNumber(i,a.label)},selectedPhoneNum:function(e,a,o){if(P.itemInDropdown=e,e.label!==r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]){var t=a+"Data";h.selectedPhoneNum(e,a,P.phoneObj,r,P.phoneNumberData,i,P[t],P.phoneTypes),e.label===r["ease.core.migrationacctsetup.migration.select.nonumber.label"]&&h.ariaPress("");var n={mobile:P.mobileData,home:P.homeData,work:P.workData};h.checkDefaultPrimary(P.phoneTypes,P.phoneObj,r,n),P.setPrimaryPhone()}else P.phoneObj.selectedPhoneCriteria[a].primaryFlag=!1,P.phoneObj.selectedPhoneCriteria[a].phonePrimaryDisable=!0,P.phoneObj.selectedPhoneCriteria[a].tcpaMsg=""},booleanPrimary:function(){P.phoneObj.selectedPhoneCriteria.mobile.primaryFlag=!1,P.phoneObj.selectedPhoneCriteria.work.primaryFlag=!1,P.phoneObj.selectedPhoneCriteria.home.primaryFlag=!1},primaryToggle:function(a,i){if(e.element(a.target).hasClass("icon-star-disable"))a.preventDefault();else{P.booleanPrimary("");var o=e.element(a.target).attr("id");o=o.split("Primary")[0],P.phoneObj.selectedPhoneCriteria[o].primaryFlag=!0;var t={label:P.phoneObj.selectedPhoneCriteria[o].label,phoneType:o,primaryFlag:P.phoneObj.selectedPhoneCriteria[o].primaryFlag,phonePrimaryDisable:!1,tcpaFlag:P.phoneObj.selectedPhoneCriteria[o].tcpaFlag,tcpaMsg:h.getTcpaMsg(P.phoneObj.selectedPhoneCriteria[o].tcpaFlag,r)},n=o+"Data";h.changeDataHolder(t,P.phoneTypes,P.phoneObj,r,P[n]),P.setPrimaryPhone(),d.pubsubTrackAnalytics({name:"make "+o+" primary:button"})}},getAriaLabel:function(e){return e===r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]?"Add phone number button":e},isContinueDisabled:function(){return!P.phoneObj.selectedPhoneCriteria.mobile.primaryFlag&&!P.phoneObj.selectedPhoneCriteria.work.primaryFlag&&!P.phoneObj.selectedPhoneCriteria.home.primaryFlag||P.isPrimaryEmailInvalid()||P.isButtonClicked},displayError:function(){return!P.phoneObj.selectedPhoneCriteria.mobile.primaryFlag&&!P.phoneObj.selectedPhoneCriteria.work.primaryFlag&&!P.phoneObj.selectedPhoneCriteria.home.primaryFlag},migrateContinue:function(){h.setFailures(!1),h.clearPromises(),P.loading="loading",P.isButtonClicked=!0,h.saveDetails(P.phoneObj,P.phoneTypes,P.emailList,i,r),g.all(h.getPromises()).then(function(){P.isButtonClicked=!1,P.loading="",h.hasFailed()||h.updateFixUpFlow().then(function(e){e&&!e.easeDisplayError&&u.go(m.states.kWelcome)})})}}),P.getPhoneNumber(n,P.phoneTypes)}var i=e.module("MigrateModule");i.controller("MigrateController",a),a.$inject=["$scope","profileInfoFactory","contentDataMigration","contentDataProfilePref","emailData","phoneNumberData","featureToggleData","migrateFeatureToggleData","EaseConstant","errorContentData","$rootScope","ContentConstant","migrateFactory","$state","pubsubService","$q"]});