define(["angular"],function(e){function a(a,r,t,n,o,i,l,s,c,p){function h(e,a){var r;return r=null==e?"":e===!0?a["ease.core.migrationacctsetup.migration.TCPA.on.label"]:a["ease.core.migrationacctsetup.migration.TCPA.off.label"]}function u(a){if(e.element(document.getElementsByClassName("togglePrimary")).attr("aria-pressed",!1),a){var r=a+"Primary",t=e.element(document.getElementById(r));t.attr("aria-pressed",!0)}}function m(e,a,r){var t="No Number"===e[a].label||e[a].label===r["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]||e[a].label===r["ease.core.migrationacctsetup.selectnum.label"];if(!t&&e[a].label){var n={isPrimary:e[a].primaryFlag,phoneNumber:e[a].label.replace(/[^\/\d]/g,""),phoneType:a,hasTcpaConsent:e[a].tcpaFlag};return n}}function d(e){Y=e}function g(e){z=e}function y(){return z}function P(e){var t=e.easeDisplayError;t&&t.severity>="1"&&(g(!0),a.$broadcast("error",{msgHeader:t.headerMessage?t.headerMessage:Y.common_snag_en_US[r.kSnagModalHeader],msgBody:t.displayMessage?t.displayMessage:Y.common_snag_en_US["core.common.snag.featureoff.short.label"]}))}function b(e,a){if(e.phoneSelectedItem){var r={isPrimary:e.primaryFlag,phoneNumber:e.phoneSelectedItem.replace(/[^\/\d]/g,""),phoneType:a,hasTcpaConsent:e.tcpaFlag};return r}}function f(e,a,r,t){var n=[];e.forEach(function(e){"No Number"!==a.selectedPhoneCriteria[e].label&&a.selectedPhoneCriteria[e].label!==r["ease.core.migrationacctsetup.selectnum.label"]&&n.push(e)}),1===n.length&&n.forEach(function(n){a.selectedPhoneCriteria[n].primaryFlag=!0,u(n);var o={label:a.selectedPhoneCriteria[n].label,phoneType:n,primaryFlag:a.selectedPhoneCriteria[n].primaryFlag,phonePrimaryDisable:!1,tcpaFlag:a.selectedPhoneCriteria[n].tcpaFlag,tcpaMsg:h(a.selectedPhoneCriteria[n].tcpaFlag,r)},i=t[n];O(o,e,a,r,i)})}function C(e,a,r,t,n){var o;if(e)for(o in e){r.dataHolder[o]=[],r.dataHolder[o].push(V),v(r,e,o,t,n),r.selectedPhoneCriteria[o].checkSelectSequence.push(V);var i={label:t["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]};r.dataHolder[o].push(i)}}function v(e,a,r,t){if(R=!1,a[r].length>0){for(var n in a[r])if(a[r][n].formattedPhoneNumber){var o={label:a[r][n].formattedPhoneNumber,tcpaFlag:a[r][n].hasTcpaConsent,primaryFlag:a[r][n].isPrimary,phoneType:r,tcpaMsg:h(a[r][n].hasTcpaConsent,t),source:a[r][n].source};e.dataHolder[r].push(o),R||T(r,a[r][n],t,e),e.selectedPhoneCriteria[r].checkSelectSequence.push(o)}}else F(e,r,t["ease.core.migrationacctsetup.migration.select.nonumber.label"],t)}function T(e,a,r,t){var n=a.formattedPhoneNumber.replace(/[\(\)\.\-\ ]/g,"");if(!isNaN(parseInt(n,10))&&!o){var o={selectedPhoneCriteria:t.selectedPhoneCriteria,selectPhoneType:e,phoneNumber:a.formattedPhoneNumber,hasTcpaConsent:a.hasTcpaConsent,isPrimary:a.isPrimary,phonePrimaryDisable:!1,contentDataMigration:r,source:a.source};x(o),o=!0}}function F(e,a,r,t){var n={selectedPhoneCriteria:e.selectedPhoneCriteria,selectPhoneType:a,phoneNumber:r,hasTcpaConsent:null,isPrimary:!1,phonePrimaryDisable:!0,contentDataMigration:t,source:""};x(n)}function E(e,a,r,t){if(e.label!==t["ease.core.migrationacctsetup.migration.select.addphonenumber.label"]){var n=S(r.selectedPhoneCriteria[a].checkSelectSequence,e.label);if(r.selectedPhoneCriteria[a].checkSelectSequence.move(0,n,e.label),isNaN(parseInt(e.label.replace(/[\(\)\.\-\ ]/g,""),10)))F(r,a,t["ease.core.migrationacctsetup.migration.select.nonumber.label"],t);else{r.selectedPhoneCriteria[a].label=e.label;var o={selectedPhoneCriteria:r.selectedPhoneCriteria,selectPhoneType:a,phoneNumber:e.label,hasTcpaConsent:e.tcpaFlag,isPrimary:e.primaryFlag,phonePrimaryDisable:e.phonePrimaryDisable,contentDataMigration:t,source:""};x(o)}}}function S(e,a){for(var r=0;r<e.length;r++)if(e[r].label===a)return r;return-1}function N(){return L}function D(e,a,r,t,n,o,i){var l={taxonomy:{level1:"ease",level2:"migration",level3:"",level4:"add "+a+" number",level5:"",country:"us",language:"english",system:"ease_web"},lob:""},s={isPrimary:r.selectedPhoneCriteria[a].primaryFlag,phoneType:a},c={number:s,error:null,originalNumberPreferences:null,pubsubObj:l,pubSubOnClose:o,modalTitle:i};t.updatePhoneNumber(c)}function M(e){var a={isPrimary:e.phoneObj.selectedPhoneCriteria[e.updatedPhoneType].primaryFlag,phoneNumber:e.phoneObj.selectedPhoneCriteria[e.updatedPhoneType].label,phoneType:e.updatedPhoneType,hasTcpaConsent:e.phoneObj.selectedPhoneCriteria[e.updatedPhoneType].tcpaFlag};e.profileInfoFactory.openEditTcpaSettingsModal(a,void 0,e.pubsubObj,e.pubsubObjMigration)}function A(){var e=t.defer(),a={BUS_EVT_ID:"50108",EVT_SYNCH_TOKEN:i.getSyncId()},r=n.all("customer/customerPlatformDetails"),o={pathStepsUpdate:[{stepTypeCode:"EASEM_MIGRATION",stepTypeStatus:"PROCESSED"}]};return r.post(o,{},a).then(function(a){e.resolve(a)},function(a){console.log("Path finder POST failed",a.status),e.reject()}),e.promise}function H(e){var a=e.phoneNumber.toString();this.formattedPhoneNumber="("+a.slice(0,3)+") "+a.slice(3,6)+"-"+a.slice(6),this.isPrimary="true"===e.isPrimary,this.phoneType=e.phoneType,this.hasTcpaConsent="true"===e.hasTcpaConsent,this.source=e.source}function w(e){var a,r={home:[],work:[],mobile:[]};for(var t in e)Array.isArray(e[t])&&e[t].forEach(function(e){a=t.split("PhoneNumbersMigrated")[0],r[a].push(new H(e))});return r}function k(){var e=t.defer(),a=o.kGetKnownPhoneNumbersUrl;return n.setBaseUrl(l.baseUrl()),i.clearCustomerActivityHeader(),i.setCustomerActivityHeader("50124"),n.all(a).customGET().then(function(a){if(a.easeDisplayError&&"2"===a.easeDisplayError.severity&&"200900"===a.easeDisplayError.errorIdString){var r={};r.value=a.easeDisplayError,p.go(o.states.kEscid,r)}e.resolve(w(a.entries))},function(a){throw e.reject(),c.createEaseException({module:"MigrationDisplayPhoneNumbers",message:a.statusText,cause:a})}),i.clearCustomerActivityHeader(),e.promise}function O(e,a,r,t,n){for(var o=0;o<a.length;o++){var i=a[o],l=S(r.dataHolder[i],e.label);e.phoneType===i?(-1!==l?j(r,i,l,e,t):_(r,i,e,t),n.placeholder=e.label):(-1!==l&&q(i,r,l,e,t),e.primaryFlag&&I(i,r,!e.primaryFlag))}}function j(e,a,r,t,n){var o={selectedPhoneCriteria:e.selectedPhoneCriteria,selectPhoneType:a,phoneNumber:t.label,hasTcpaConsent:t.tcpaFlag,isPrimary:t.primaryFlag,phonePrimaryDisable:t.phonePrimaryDisable,contentDataMigration:n,source:""},i={updatedPhoneType:a,newArrayElement:t,dataHolder:e.dataHolder,contentDataMigration:n},l={updatedPhoneType:a,newArrayElement:t,selectedPhoneCriteria:e.selectedPhoneCriteria,contentDataMigration:n};x(o),U(i),$(l),e.selectedPhoneCriteria[a].checkSelectSequence.move(0,r,l)}function _(e,a,r,t){e.dataHolder[a].splice(e.dataHolder[a].length-1,0,r),e.selectedPhoneCriteria[a].checkSelectSequence.splice(0,0,r);var n={selectedPhoneCriteria:e.selectedPhoneCriteria,selectPhoneType:a,phoneNumber:r.label,hasTcpaConsent:r.tcpaFlag,isPrimary:r.primaryFlag,phonePrimaryDisable:!1,contentDataMigration:t,source:""};x(n),r.primaryFlag&&I(a,e,r.primaryFlag)}function q(e,a,r,t,n){var o=a.selectedPhoneCriteria[e].checkSelectSequence;a.dataHolder[e][r].tcpaFlag=t.tcpaFlag,a.dataHolder[e][r].tcpaMsg=h(t.tcpaFlag,n),o[S(o,t.label)].tcpaFlag=t.tcpaFlag,o[S(o,t.label)].tcpaMsg=h(t.tcpaFlag,n),a.selectedPhoneCriteria[e].label===t.label&&(a.selectedPhoneCriteria[e].tcpaFlag=t.tcpaFlag,a.selectedPhoneCriteria[e].tcpaMsg=h(a.selectedPhoneCriteria[e].tcpaFlag,n))}function I(e,a,r){a.selectedPhoneCriteria[e].primaryFlag=r;for(var t=0;t<a.dataHolder[e].length;t++)a.dataHolder[e][t].primaryFlag=r;for(var n=0;n<a.selectedPhoneCriteria[e].checkSelectSequence.length;n++)a.selectedPhoneCriteria[e].checkSelectSequence[n].primaryFlag=r}function U(e){for(var a=e.dataHolder,r=0,t=a[e.updatedPhoneType].length;t>r;r++)if(a[e.updatedPhoneType][r].label===e.newArrayElement.label){a[e.updatedPhoneType][r].tcpaFlag=e.newArrayElement.tcpaFlag,a[e.updatedPhoneType][r].tcpaMsg=h(e.newArrayElement.tcpaFlag,e.contentDataMigration),a[e.updatedPhoneType][r].primaryFlag=e.newArrayElement.primaryFlag,a[e.updatedPhoneType][r].phonePrimaryDisable=e.newArrayElement.phonePrimaryDisable;break}}function $(e){for(var a=e.selectedPhoneCriteria[e.updatedPhoneType].checkSelectSequence,r=0,t=a.length;t>r;r++)if(a[r].label===e.newArrayElement.label){a[r].tcpaFlag=e.newArrayElement.tcpaFlag,a[r].tcpaMsg=h(e.newArrayElement.tcpaFlag,e.contentDataMigration),a[r].primaryFlag=e.newArrayElement.primaryFlag,a[r].phonePrimaryDisable=e.newArrayElement.phonePrimaryDisable;break}}function x(e){e.selectedPhoneCriteria[e.selectPhoneType].label=e.phoneNumber,e.selectedPhoneCriteria[e.selectPhoneType].tcpaFlag=e.hasTcpaConsent,e.selectedPhoneCriteria[e.selectPhoneType].tcpaMsg=h(e.hasTcpaConsent,e.contentDataMigration),e.selectedPhoneCriteria[e.selectPhoneType].primaryFlag=e.isPrimary,e.selectedPhoneCriteria[e.selectPhoneType].phonePrimaryDisable=e.phonePrimaryDisable,e.selectedPhoneCriteria[e.selectPhoneType].source=e.source}function B(e){var a,r,l;return a={entries:e},r=n.all(o.kAllPhonesUrl),l=t.defer(),i.clearCustomerActivityHeader(),i.setCustomerActivityHeader("50131"),r.customPUT(a).then(function(e){l.resolve(e)},function(e){s.info("All phone number Error with status code",e.status),l.reject(e)}),i.clearCustomerActivityHeader(),l.promise}function G(e,a,r,t,n){var o,i=[];r&&r.editFlow&&t.editEmail(r).then(P);for(var l=0;l<a.length;l++)o=this.getPhoneObject(e.selectedPhoneCriteria,a[l],n),o&&i.push(o);if(i&&i.length>0){var s=this.saveAllPhones(i);L.push(s),s.then(P)}}function K(){return L=[]}var R,V={label:"No Number",tcpaFlag:null,primaryFlag:!1,phonePrimaryDisable:!0,phoneType:"",tcpaMsg:""},L=[],Y={},z=!1;return Array.prototype.move=function(e,a){return this.splice(a,0,this.splice(e,1)[0]),this},{getTcpaMsg:h,setPhoneNumberData:v,selectedPhoneNum:E,setErrorContentData:d,savePhoneNumber:b,ariaPress:u,checkDefaultPrimary:f,getPhoneNumber:C,getPromises:N,updateFixUpFlow:A,hasFailed:y,setFailures:g,editPhoneNumber:D,openEditTcpaSettingsModal:M,getKnownPhoneNumberList:k,changeDataHolder:O,setSelectPhoneCriteria:x,getPhoneObject:m,saveAllPhones:B,saveDetails:G,clearPromises:K}}var r=e.module("MigrateModule");return r.factory("migrateFactory",a),a.$inject=["$rootScope","ContentConstant","$q","Restangular","EaseConstant","EASEUtilsFactory","EaseConstantFactory","$log","easeExceptionsService","$state"],r});