define(["angular"],function(e){"use strict";function a(e,a,t,n,s,l,c,i,o,m,r,g){function u(e){if(e.element&&e.element.validAsOfTimestamp&&_.isEqual(e.element.category,"CC")){var a=new Date(e.element.validAsOfTimestamp);e.messageObj={type:"GENERAL",level:"critical",message:"Your account details were last updated "+n("date")(a,"MMM d 'at' HH:mm a")+"."}}}function d(n,i){n.element.checkAmountDigits=function(){var e=parseFloat(n.element.dollarAmount.replace(/,/g,""));if(e>999999){var a=document.getElementsByClassName("amount");a[n.index].classList.add("million")}},a.getFocusForEscapeHatch();var m=e.getContentData();n.loading="",n.alertIcon=m["ease.core.acctsummary.alert.image"],i.bind("click",function(){n.element.isNotClickable||n.element.hasNoLoadingClass||(this.childNodes[0].style.height=this.childNodes[0].clientHeight+"px",n.loading="loading")});var r=function(){if(!(n.nbrOfAccount>=1)){var t=e.getSecondaryDataForLob(n.element,n.messageObj,n.nbrOfAccount),s=!1;null!==t&&n.nbrOfAccount>=1&&(null!==t.attrVal&&void 0!==n.element[t.attrVal]?(n.messageObj={type:"SecondaryData",level:"",message:t.message+a.commaFormattedMoneyByCurrency(n.element[t.attrVal],"USD")},s=!0):(n.messageObj=t,s||(n.messageObj={type:"SecondaryData",level:"",message:t[0]?t[0].message:""}),s=!0)),s||"undefined"!=typeof t[0]&&(n.messageObj={type:"SecondaryData",level:"",message:t[0].message})}};if(n.element.contentImage){var d=c.urlContent;a.isHighDensityScreen()?(n.element.bground=d+n.element.contentImage.hiRes.tileBackground,n.element.imagePath=n.element.contentImage.hiRes.logo?d+n.element.contentImage.hiRes.logo:""):(n.element.bground=d+n.element.contentImage.lowRes.tileBackground,n.element.imagePath=n.element.contentImage.lowRes.logo?d+n.element.contentImage.lowRes.logo:"")}!n.element.showPrimaryData||"HIL"!==n.element.category&&"HLC"!==n.element.category||(parseFloat(n.element.availableBalance)>0&&(0==n.element.availableBalance||n.element.availableBalance)?n.element.primaryDisplayData=m["ease.core.acctsummary.availbal.label"]:(parseFloat(n.element.availableBalance)<=0||""===n.element.availableBalance||n.element.availableBalance&&""===n.element.availableBalance.toString().trim()||!n.element.availableBalance)&&(0===n.element.displayBalance||n.element.displayBalance&&""!==n.element.displayBalance.toString().trim())?n.element.primaryDisplayData=m["ease.core.acctsummary.principal.label"]:("null"===n.element.availableBalance&&n.element.displayBalance||0===n.element.displayBalance||n.element.displayBalance&&""!==n.element.displayBalance.toString().trim())&&(n.element.primaryDisplayData=m["ease.core.acctsummary.principal.label"])),n.element.accountMessage?n.element.accountMessage[0].message?n.messageObj=n.element.accountMessage[0]:(n.element.accountMessage[0].message="",n.messageObj=n.element.accountMessage[0],u(n)):(r(),u(n)),n.closeMessage=function(e){r(),e.preventDefault(),e.stopPropagation()},n.navigateToMudFlapLink=function(e,n){n.msgLink.path&&(a.redirectLinking(n.msgLink),o.pubsubTrackAnalytics({name:"mudflap:link",interactionMessage:{click:n.messageAnalyticsTracker}}),n.responseUrlHref&&t.responseMessageApi(n.responseUrlHref,"ACCEPT","summary","50000")),e.stopPropagation()},n.getStateMessageClass=function(){var e="";return n.selected!==n.index&&void 0!==n.messageObj&&void 0!==n.messageObj.message&&(e+=""!==n.messageObj.message&&"open"===n.messageObj.level?"info":n.messageObj.level?n.messageObj.level:"info"),1===n.nbrOfAccount&&(n.messageObj&&"togglerestricted"===n.messageObj.level&&""===e&&(e+="togglerestricted"),e+=" singleProdView"),e.trim()},n.showStateMessage=function(){var e=s.getFeatureToggleData();if(e[l.features.enableMudFlap]===!1&&void 0!==n.messageObj&&void 0!==n.messageObj.article)return!0;var a="undefined"==typeof n.messageObj||"undefined"==typeof n.messageObj.message||""===n.messageObj.message;return n.selected===n.index||void 0!==n.messageObj&&-1!==["togglerestricted","unavailable","restricted","closed"].indexOf(n.messageObj.level)||a},n.getTruncatedMessage=function(){return void 0!==n.messageObj&&"critical"===n.messageObj.level?n.messageObj.message:void 0},n.showIconMessage=function(){return n.messageObj?-1!==["critical","closed","restricted"].indexOf(n.messageObj.level):void 0},n.showCloseIcon=function(){},n.service=t,n.$watch("service.messagingReferenceId",function(e,a){(e||e===a)&&t.messages.forEach(function(e){if(n.element.referenceId===e.messagingReferenceId){if(n.element.accountMessage||(n.element.accountMessage=[]),0===n.element.accountMessage.length){var a=e.flapMessages.length;if(!n.element.validAsOfTimestamp){if(a>0)for(var t=0;a>t;t++)if(""!==e.flapMessages[t].message){n.element.accountMessage.push(e.flapMessages[t]);break}n.element.accountMessage.length>0&&(n.messageObj=n.element.accountMessage[0])}}e.buttonMessage?n.element.actionButton=e.buttonMessage:g.get("accountSummary").then(function(e){var a={action:e.viewAccount||l.defaultBtnAction,buttonText:e.viewAccount||l.defaultBtn,messageAnalyticsTracker:"",pubsub:"default"};n.$evalAsync(function(){n.element.actionButton=a})})}})})}return{restrict:"AE",transclude:!0,scope:{selected:"=selected",index:"=idx",element:"=obj",nbrOfAccount:"=nbrOfAccount"},templateUrl:"/ease-ui/dist/AccountSummary/html/directives/accountMessage.html",link:d}}function t(){function a(a,t){t.bind("error",function(){a.summary.greeting.showDefaultBgImg=!0,t[0].src=""}),t.bind("load",function(){var a='url("'+t[0].src+'")',n=document.getElementById("humanity");e.element(n).addClass("bgImgAnimation"),n.style["background-image"]=a})}return{restrict:"A",link:a}}var n=e.module("summaryModule");n.directive("accountMessage",a),a.$inject=["TemplateSelectionFactory","EASEUtilsFactory","messagingService","$filter","featureToggleFactory","EaseConstant","ContentAccountLinks","$state","pubsubService","SingleProdService","easeCoreConstant","EaseLocalizeService"],n.directive("noCustomImg",t)});