define(["angular"],function(a){"use strict";function t(t,e,n,o,r,c,i,s,u,l,m,g,d,y,p,D,S,C,f,b,A,T,w,h,k){function L(a){return!("COI"===a.category&&!M[r.features.enableCofiTileDisplay])}l.setContentData(c);var v=this,M=S.getFeatureToggleData(),B=s.accounts.filter(L);if(v.pendingRequest=!1,v.isButtonClicked=!1,v.accounts=B,v.cofiCTAButtonFeatureToggle=M[r.features.cofiCTAButton],v.contentData=l.getContentData(),"undefined"==typeof o.sessionStorage.prefetchCheck){m.preFetchLOB(B);try{o.sessionStorage.setItem("prefetchCheck",!0),console.log("Your web browser does support storing settings locally")}catch(P){console.log("Your web browser does not support storing settings locally")}}e.$on("snag",function(a,t){t&&(v.loadingButton={},v.pendingRequest=!1,v.isButtonClicked=!1)}),a.extend(v,{i18n:u,errorContentData:A,greeting:"",bannerUrl:"/ease-ui/dist/AccountSummary/html/partials/hello.html",accountsUrl:"/ease-ui/dist/AccountSummary/html/partials/accounts.html",recentTransactionsHTML:"/ease-ui/dist/AccountSummary/html/partials/recent-transactions.html",on:!0,viewMoreDisabled:!0,errorFlag:!1,getAriaTileMsg:function(){var a=[],t=arguments[arguments.length-1];return t&&(arguments[2]="negative "+arguments[2]),Array.prototype.push.apply(a,arguments),arguments[0].format.apply(arguments[0],a.slice(1,arguments.length-1))},getBankTransactionAmountClass:function(a){var t=!1;return a.transactionAmount?("Credit"===a.debitCardType&&(t=!0),t):t},getCreditTransactionAmountClass:function(a){var t=!1;return a.transactionAmount?("creditTransaction"===a.creditTransaction&&(t=!0),t):t},isScheduledTransaction:function(a,t){var e=!1;return"al"===!a.toLowerCase()?e:("scheduled"===t.transactionState.toLowerCase()&&(e=!0),e)},getAriaTransactionMsg:function(a,t){if(t){var e=new Date(t.transactionDate),n=e.getDate()<10?"0"+e.getDate():e.getDate();return v.getAriaTileMsg(v.i18n.ariaMsg.transaction[a.toUpperCase()][t.transactionState.toUpperCase()],v.i18n.amountSymbol,t.transactionAmount,f.DATETIME_FORMATS.MONTH[e.getMonth()],n,t.transactionDescription,!1)}return""},focusId:"",root:e,loadingButton:{},transfer:function(a,t,e){a.stopImmediatePropagation();var o=m.SelectDetailsTransaction(t).pubSubLob;v.isButtonClicked?(a.stopImmediatePropagation(),a.stopPropagation()):(a.cancelBubble=!0,v.pendingRequest=!0,v.isButtonClicked=!0,v.selectedModal=e,v.loadingButton[e]="loading",v.focusId=a.currentTarget.id,D.setCurrentLOB("accountSummary"),n.go("accountSummary.transfer",{category:t.category,subCategory:o,referenceId:t.referenceId,focusId:v.focusId}).then(function(){v.pendingRequest=!1,v.isButtonClicked=!1,v.loadingButton[e]=""}))},refreshAccountSummary:function(){k.notify("accountSummary",function(){n.go("accountSummary",{},{reload:!0}).then(function(){v.pendingRequest=!1,v.isButtonClicked=!1})})},payNow:function(a,t,e){function n(){v.loadingButton[e]="",v.pendingRequest=!1,v.isButtonClicked=!1,r.isEnableActionButton=!0}if(v.isButtonClicked)a.stopImmediatePropagation(),a.stopPropagation();else{a.cancelBubble=!0,v.pendingRequest=!0,v.isButtonClicked=!0,v.selectedModal=e,v.focusId=a.currentTarget.id,v.loadingButton[e]="loading";var o=(m.SelectDetailsTransaction(t).pubSubLob,{lineOfBusiness:t.category,isAccountDataAvailable:"",stopSpinner:n,refreshAccountSummary:v.refreshAccountSummary});v.paymentParam={accountReferenceId:t.referenceId,payment:o},l.payNow(v.paymentParam)}},goToLink:function(a){a.path&&(m.redirectLinking(a),g.pubsubTrackAnalytics({name:"global messaging:link",interactionMessage:{click:a.messageAnalyticsTracker}}),a.responseUrlHref&&p.responseMessageApi(a.responseUrlHref,"ACCEPT","summary","50000"))},enableActions:function(){v.pendingRequest=!1,v.isButtonClicked=!1},actionButton:function(a,t,e){switch(v.isButtonClicked&&(a.stopPropagation(),a.stopImmediatePropagation()),t.actionButton.action){case"payment":a.cancelBubble=!0,r.isEnableActionButton&&(r.isEnableActionButton=!1,g.pubsubTrackAnalytics({name:t.actionButton.buttonText.toLowerCase()+":button",interactionMessage:{click:t.actionButton.messageAnalyticsTracker}}),v.handlekeyEvents(a),this.payNow(a,t,e));break;case"transfer":g.pubsubTrackAnalytics({name:t.actionButton.buttonText.toLowerCase()+":button",interactionMessage:{click:t.actionButton.messageAnalyticsTracker}}),this.transfer(a,t,e);break;case"accountdetails":t.subCategory&&"retail"===t.subCategory.toLowerCase()&&M&&!M[r.features.enableRetailNavigation]?(o.open(C.urlRetail,"_blank"),v.isButtonClicked=!1,a.stopPropagation()):t.subCategory&&"retail"===t.subCategory.toLowerCase()&&M&&M[r.features.enableRetailNavigation]&&-1===["DDA","SA","MMA"].indexOf(t.category)?(o.open(C.urlRetail,"_blank"),v.isButtonClicked=!1,a.stopPropagation()):("default"===t.actionButton.pubsub?g.pubsubTrackAnalytics(l.pubsubBtnTrackAnalyticswithMsg("default view accounts:button",t.actionButton.messageAnalyticsTracker)):g.pubsubTrackAnalytics(l.pubsubBtnTrackAnalyticswithMsg("view accounts:button",t.actionButton.messageAnalyticsTracker)),this.goToDetail(a,t,e))}t.actionButton.responseUrlHref&&p.responseMessageApi(t.actionButton.responseUrlHref,"ACCEPT","summary","50000")},accountSummaryTransactionData:[],accountSummaryData:v.accounts,storageName:i.storageName(),currentFeature:"AccountSummary",productType:"default",accountNumber:"",selected:"",selectedModal:"",showSecondaryData:!1,loadingModal:function(a){return a===v.selectedModal?"loadingModal":""},isNotClikable:{},isideAccount:{},showHeaderTransaction:function(a,t){return 0===a||a>0&&v.accountSummaryTransactionData[a-1].transactionState!==t.transactionState?!0:!1},showTransactionStatus:function(a){return"pending"===a.transactionState.toLowerCase()?!0:"scheduled"===a.transactionState.toLowerCase()?!0:!1},showTransactionDate:function(a){return"posted"===a.transactionState.toLowerCase()||"scheduled"===a.transactionState.toLowerCase()||"pending"===a.transactionState.toLowerCase()&&"al"===v.accountSummaryData[0].category.toLowerCase()?!0:!1},isLogoVisible:function(a){return a.categoryIconURL&&""!==a.categoryIconURL?"":"noImg"},showTransactionClass:function(a){var t=a.transactionState&&a.transactionState.toLowerCase()?a.transactionState.toLowerCase():null;switch(t){case"pending":return"pending";case"scheduled":return"scheduled";case"posted":return"posted";default:return""}},showNegativeSignAutoLoan:function(a){var t=v.accountSummaryData[0].category&&v.accountSummaryData[0].category.toUpperCase()?v.accountSummaryData[0].category.toUpperCase():null,e=a.transactionState&&a.transactionState.toUpperCase()?a.transactionState.toUpperCase():null,n=a.transactionType&&a.transactionType.toUpperCase()?a.transactionType.toUpperCase():null;return"AL"===t&&("SCHEDULED"===e||"PENDING"===e)&&"CREDIT"===n},alScheduledPendingTx:function(a){var t=v.accountSummaryData[0].category.toUpperCase(),e=a.transactionState&&a.transactionState.toUpperCase()?a.transactionState.toUpperCase():null;return"AL"===t&&("SCHEDULED"===e||"PENDING"===e)},alPostedPaymentTx:function(a){var t=v.accountSummaryData[0].category.toUpperCase(),e=a.transactionState&&a.transactionState.toUpperCase()?a.transactionState.toUpperCase():null,n=a.transactionType&&a.transactionType.toUpperCase()?a.transactionType.toUpperCase():null;return"AL"===t&&"POSTED"===e&&"CREDIT"===n},viewMoreTransactions:function(a){v.goToDetail(a,v.accountSummaryData[0],0)},handlekeyEvents:function(a){v.pendingRequest=!1,v.isButtonClicked=!1,a.cancelBubble=!0,a.stopImmediatePropagation()},goToDetail:function(a,t,e){null!=a&&(v.focusId=a.currentTarget.id);var c=a.target.localName||a.srcElement.localName;if("undefined"!=typeof c&&"keypress"===a.type&&"button"===c&&!v.isButtonClicked)return a.stopPropagation(),void a.stopImmediatePropagation();if(!v.isButtonClicked){if(v.isButtonClicked=!0,v.pendingRequest=!0,t.subCategory&&"retail"===t.subCategory.toLowerCase()&&M&&!M[r.features.isRetailToggleRestricted]&&"View More"!==a.currentTarget.innerHTML)return void v.enableActions();if(t.subCategory&&"retail"===t.subCategory.toLowerCase()&&M&&!M[r.features.enableRetailNavigation])o.open(C.urlRetail,"_blank"),v.handlekeyEvents(a);else if(t.subCategory&&"retail"===t.subCategory.toLowerCase()&&M&&M[r.features.enableRetailNavigation]&&-1==["DDA","SA","MMA","CD"].indexOf(t.category))o.open(C.urlRetail,"_blank"),v.handlekeyEvents(a);else if("undefined"==typeof t.isNotClickable||"undefined"!==t.isNotClickable&&!t.isNotClickable){var i={accountReferenceId:t.referenceId,ProductName:t.originalProductName.replace(/\s+/g,""),accountDetails:{lineOfBusiness:t.category,accountNumber:t.accountNumberTLNPI}};if("CC"===t.category&&(i.ProductName="Card"),"COI"===t.category){g.pubsubTrackAnalytics({name:"COFI Tile:button"});var s="ease-ui/bower_components/easeCustomerFeatures"+r.kBuildVersionPath+"/AccountSummary/html/cofiLinkout-index.html";s+="?accountReferenceId="+encodeURIComponent(t.referenceId),s+="&customerRole="+t.customerRole,o.open(s,"_blank"),v.handlekeyEvents(a)}t.subCategory&&(i.accountDetails.subCategory=t.subCategory),t.productId&&(i.accountDetails.productId=t.productId),v.selected=e,"View More"===a.currentTarget.innerHTML?g.pubsubTrackAnalytics({name:"singleAccount view more:link"}):"singleProduct"===v.isSingleProductViewData()&&g.pubsubTrackAnalytics({name:"singleAccount transaction:link"}),n.go(m.SelectDetailsTransaction(t).lobType+"Details.transactions",i).then(function(){v.enableActions(),a.stopImmediatePropagation(),a.preventDefault()})}else v.enableActions()}},showATMFinder:function(){v.isButtonClicked&&13===evt.keyCode||(n.go("accountSummary.atmFinder",{category:"AtmFinder"}),v.isButtonClicked=!1)},isModalLoading:function(){for(var a in v.loadingButton)if("loading"===v.loadingButton[a])return!0;return!1},trimmmedAccountNumber:function(a){return a.substring(a.length-4,a.length)},GetImage:function(a){return v.ImagePath="/ease-ui"+r.kBuildVersionPath+"/dist/features/AccountSummary/images/"+a+".png",!0},getPointer:function(a){return a.isDisplayAccount},getSummaryTemplate:function(a,t){var e=m.isInActiveProduct(a);a.isNotClickable=e.isNotClickable,a.category&&"COI"===a.category.toUpperCase()&&(M&&!M[r.features.enableCofiTileNavigation]?a.isNotClickable=!0:a.isNotClickable=!1,a.hasNoLoadingClass=!0),a.subCategory&&"retail"===a.subCategory.toLowerCase()&&(M&&!M[r.features.isRetailToggleRestricted]?a.isNotClickable=!0:a.subCategory&&"retail"===a.subCategory.toLowerCase()&&M&&M[r.features.enableRetailNavigation]&&-1===["DDA","SA","MMA","CD"].indexOf(a.category)?a.isNotClickable=!0:M&&M[r.features.enableRetailNavigation]&&(a.isNotClickable=!1),v.viewMoreDisabled=!0);var n=l.getSummaryTypeTemplate(e.category);return n.match("default.html$")&&(a.isNotClickable=!0),n},GetModalPaymentTemplate:function(a){return l.getModalTemplate(a)},isSingleProductViewData:function(){if(1===v.accountSummaryData.length){S.getFeatureToggleData();return v.accountSummaryData[0].singleAccountViewEnabled?"singleProduct":"toggleRestrictedMessage"}return"multipleProduct"},isDetailAccessible:function(a){var t=!0;return a.accountMessage&&("closed"===a.accountMessage[0].level||"restricted"===a.accountMessage[0].level)&&(t=!1),t},showViewMoreButton:!0,getSingleProductViewData:function(){v.transactionsloadingClass=r.loading,v.accountDetailloadingClass=r.loading,v.accountSummaryAccountDetail={},v.accountDetailFormatClass="formatLoading",("HIL"===v.accountSummaryData[0].category||"HLC"===v.accountSummaryData[0].category)&&parseFloat(v.accountSummaryData[0].availableBalance)>0&&(v.accountDetailloadingClass=""),v.accountSummaryAccountDetail.secondaryData=l.formatSecondaryData(v.accountSummaryData[0],v.accountSummaryAccountDetail,v.i18n),v.accountDetailloadingClass="",v.showSecondaryData=l.showSecondaryData(v.accountSummaryAccountDetail.secondaryData);var a={lineOfBusiness:m.SelectDetailsTransaction(v.accountSummaryData[0]).lobType,ProductCategory:v.accountSummaryData[0].category,accountNumber:v.accountSummaryData[0].accountNumberTLNPI};v.isDetailAccessible(v.accountSummaryData[0])?b.getSingleProductViewData(a,v.accountSummaryData[0].referenceId).then(function(t){v.accountDetailloadingClass="",t.displayMessage?(v.transactionsloadingClass="noTransaction",v.transactionerror=t.displayMessage,v.errorFlag=!0):void 0===t.transactionsResponse&&void 0===t.accountDetails?(v.accountSummaryAccountDetail.amountSymbol=v.i18n.amountSymbol,v.accountSummaryAccountDetail.percentage=v.i18n.percentage,v.transactionsloadingClass="noTransaction",v.transactionerror=v.contentData["ease.core.acctsummary.single.norecent.label"],v.errorFlag=!0):("DDA"===v.accountSummaryData[0].category||"SA"===v.accountSummaryData[0].category||"MMA"===v.accountSummaryData[0].category||"CC"===v.accountSummaryData[0].category||"AL"===v.accountSummaryData[0].category||"HLC"===v.accountSummaryData[0].category||"HIL"===v.accountSummaryData[0].category||"MLA"===v.accountSummaryData[0].category||"ILA"===v.accountSummaryData[0].category?v.accountSummaryAccountDetail=t.transactionsResponse.transactions:v.accountSummaryAccountDetail=t.accountDetails,v.accountSummaryAccountDetail.amountSymbol=v.i18n.amountSymbol,v.accountSummaryAccountDetail.percentage=v.i18n.percentage,v.transactionsloadingClass="",v.accountSummaryAccountDetail.secondaryData=l.formatSecondaryData(v.accountSummaryData[0],v.accountSummaryAccountDetail,v.i18n),v.accountDetailloadingClass="",v.showSecondaryData=l.showSecondaryData(v.accountSummaryAccountDetail.secondaryData),"DDA"===v.accountSummaryData[0].category||"SA"===v.accountSummaryData[0].category||"MMA"===v.accountSummaryData[0].category||"CC"===v.accountSummaryData[0].category||"AL"===v.accountSummaryData[0].category||"HLC"===v.accountSummaryData[0].category||"HIL"===v.accountSummaryData[0].category||"MLA"===v.accountSummaryData[0].category||"ILA"===v.accountSummaryData[0].category?v.accountSummaryTransactionData=b.formatDataForSingleProdView(t.transactionsResponse.transactions,a.ProductCategory,v.i18n):v.accountSummaryTransactionData=b.formatDataForSingleProdView(t,a.ProductCategory,v.i18n),0===v.accountSummaryTransactionData.length?(v.transactionsloadingClass="noTransaction",v.transactionerror=v.contentData["ease.core.acctsummary.single.norecent.label"],v.errorFlag=!0):v.transactionsloadingClass="yesTransaction")},function(a){throw v.accountDetailloadingClass="",v.transactionsloadingClass="noTransaction",v.transactionerror=v.i18n.errorTransaction,v.errorFlag=!0,d.createEaseException({module:"summaryModule.controller","function":"accountSummaryController.getSingleProductViewData",cause:a})}):(v.showViewMoreButton=!1,v.showSecondaryData=!1,v.accountDetailloadingClass="",v.transactionsloadingClass="noTransaction",v.transactionerror=v.contentData["ease.core.acctsummary.single.norecent.label"],v.errorFlag=!0)},reward:{display:function(){return"undefined"!=typeof v.accountSummaryData[0]&&"undefined"!=typeof v.accountSummaryData[0].reward&&"undefined"!=typeof v.accountSummaryData[0].reward.rewardsBalanceDisplay&&v.accountSummaryData[0].reward.rewardsBalanceDisplay},isCash:function(){return v.reward.display()&&"undefined"!=typeof v.accountSummaryData[0].reward.currency&&v.accountSummaryData[0].reward.currency===v.i18n.rwdCurrencyCash},amount:function(){return v.reward.display()&&"undefined"!=typeof v.accountSummaryData[0].reward.balance?v.accountSummaryData[0].reward.balance:""},category:function(){var a=v.reward.display()&&"undefined"!=typeof v.accountSummaryData[0].reward.currency?v.accountSummaryData[0].reward.currency:"",t={};return t[v.i18n.rwdCurrencyCash]=v.i18n.rwdCash,t[v.i18n.rwdCurrencyMiles]=v.i18n.rwdMiles,t[v.i18n.rwdCurrencyPoints]=v.i18n.rwdPoints,""===a?"":t[a]},ariaLabel:function(){return v.reward.isCash()?v.getAriaTileMsg(v.i18n.ariaMsg.tile.creditcardDetailData1,v.i18n.rwdCash,v.i18n.amountSymbol,arguments[0],arguments[1],arguments[2],!1):v.getAriaTileMsg(v.i18n.ariaMsg.tile.creditcardDetailDataMilesPoints,v.reward.category(),arguments[0],arguments[2],!1)}}}),1===v.accountSummaryData.length&&(M[r.features.coafSingleAccountTransactionViewFeature]&&"AL"===v.accountSummaryData[0].category?v.getSingleProductViewData():"AL"!==v.accountSummaryData[0].category&&v.getSingleProductViewData()),v.greeting=p.getGlobalMessage("noBackgroundImg"),t.$on("UPDATE_GLOBAL_MSG",function(a,t,e,n){null!==t?v.greeting=t:null!==e&&(v.accountSummaryData[n].paymentdueMsg=e)}),v.isShowATMFinderButton=function(){return v.isBankAccount()&&v.isATMFinderToggledOn()},v.isBankAccount=function(){return _.find(v.accountSummaryData,function(a){return"MMA"===a.category||"SA"===a.category||"DDA"===a.category})},v.isATMFinderToggledOn=function(){return M[r.features.enableATMFinder]},t.$watch(function(){return v.pendingRequest},function(a){e.$broadcast("disable",a)},!0)}var e=a.module("summaryModule");e.controller("AccountSummaryController",t),t.$inject=["$scope","$rootScope","$state","$window","EaseConstant","contentDataAccountSummary","EaseConstantFactory","accountSummaryData","i18nData","TemplateSelectionFactory","EASEUtilsFactory","pubsubService","easeExceptionsService","EaseLocalizeService","messagingService","transferState","featureToggleFactory","RetailAccountLinks","$locale","SingleProdService","errorContentData","easeCoreConstant","summaryService","appCookie","NotifyingService"],e.controller("DisclaimerController",["$state","contentDataAccountSummary","TemplateSelectionFactory","pubsubService",function(t,e,n,o){var r=this;r.contentData=n.getContentData(),a.extend(r,{modalType:"disclaimerModal",modalClass:"icon-check",initClose:!1,hello:"hello",close:function(){o.pubsubPageView({scDLLevel1:"ease",scDLLevel2:"account summary",scDLLevel3:"",scDLLevel4:"",scDLLevel5:"",scDLCountry:"us",scDLLanguage:"english",scDLSystem:"ease_web",scDLLOB:""}),t.go("^")}}),o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"accountSummary",level3:"COFI terms and conditions",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:"investing"})}])});