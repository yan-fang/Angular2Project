define(["angular"],function(e){"use strict";var t=e.module("AtmFinderModule");return t.controller("AtmFinderController",["$scope","$state","easeUIModalService","AtmState","AtmFinderLocationData","pubsubService","summaryService",function(e,t,n,a,r,o,i){n.showModal({templateUrl:"/ease-ui/dist/AtmFinder/html/AtmFinder-index.html",controller:"AtmModalController",inputs:{data:r}}).then(function(e){e.close.then(function(){t.go(a.getCurrentLOB()),o.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"account summary",level3:"",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:i.getLobArray().join(" | ")})})})}]),t.controller("AtmModalController",["$scope","AtmFinderFactory","close","data","$timeout","$rootScope","pubsubService","$document","locationTypeFilter","EaseConstant","summaryService","_",function(e,t,n,a,r,o,i,l,c,s,u,d){var m,f,p,g=function(t){m!==t&&(e.openListItem(t.id),e.$digest())},h=function(e,t){t.open(e.get("map"),e)},b=function(e,t){t.close(e.get("map"),e)},v=function(e){for(var t=0;t<e.length;t++)e[t].eventHandlers.push(h,b,g);return e},k=function(t){var n=d.find(e.locationsData.atmListData,function(e){return e.locationId===t.locationId});n&&r(function(){e.openListItem(t.locationId)})},I=function(){var t=d.find(e.locationsData.atmListData,function(e){return e.drawerOpen===!0});t&&(t.drawerOpen=!1,C("close",t.locationId),k(t))},y=function(){var t=c(f,e.filterParameters),n=c(p,e.filterParameters);e.noResultsFound=0===t.length||1===t.length&&!t[0].locationType,d.isEqual(n,e.locationsData.markerConfig)||(e.renderedMarkers=[],I()),e.locationsData.atmListData=t,e.locationsData.markerConfig=n},A=function(){r(function(){e.$broadcast("Search_Results_Rendered")},0)},C=function(e,t){document.dispatchEvent(new CustomEvent("toggle-drawer",{detail:{actionType:e,drawerId:t}}))},D=function(e){switch(e){case"ATM-Retail":return"bank atms";case"Branch":return"bank branches";case"CB":return"cash back";case"ATM-360":return"360 atms"}};p=a.markerConfig=v(a.markerConfig),f=a.atmListData,e.close=n,e.locationsData=a,e.filterParameters=["Branch","ATM-Retail","ATM-360"],e.renderedMarkers=[],e.isFilterExpanded=!1,e.searchInput="",e.contentData=t.getContentData(),e.noResultsFound=!1,e.isInvalidInput=!1,e.loadSearchFilterImage=s.atmFilterImg,e.submitSearch=function(n){i.pubsubTrackAnalytics({name:"search"}),t.getAtmData(n).then(function(t){t&&(e.isInvalidInput=!1,p=t.markerConfig=v(t.markerConfig),p.push({lat:Number(t.lat),"long":Number(t["long"])}),f=t.atmListData,e.locationsData=t,y(),e.renderedMarkers=[],A())},function(t){t&&(e.isInvalidInput=!0,A())})},e.enlargeMarkerIcon=function(e){e.setIcon({url:e.icon.url.slice(0,-4)+"_Large"+e.icon.url.slice(-4)}),m=e},e.resetMarkerIcon=function(){m&&(m.setIcon({url:m.icon.url.slice(0,-10)+m.icon.url.slice(-4)}),m=null)},e.onListItemClick=function(t,n){var a=t.keyCode||t.which||t.charCode;("click"===t.type||13===a||32===a)&&(e.openListItem(n),t.preventDefault())},e.onResultDetailsClick=function(e){e.stopPropagation()},e.preventFormSubmission=function(e){var t=e.keyCode||e.which||e.charCode;13===t&&e.preventDefault()},e.tab={currenttab:"Map"},e.handleTabShow=function(t){e.tab.currenttab=t},e.openListItem=function(t){e.locationsData.atmListData.forEach(function(n){n.locationId===t?(n.drawerOpen=!n.drawerOpen,e.resetMarkerIcon(),n.drawerOpen?(C("open",n.locationId),e.enlargeMarkerIcon(d.find(e.renderedMarkers,function(e){return e.id===t}))):C("close",n.locationId)):n.drawerOpen&&(C("close",n.locationId),n.drawerOpen=!1)})},e.checkAccessHoursAvailablity=function(e){return!(!e||!e.length)};var w=o.$on("$stateChangeStart",n);e.$on("$destroy",function(){w()}),i.pubsubTrackAnalytics({taxonomy:{level1:"ease",level2:"atm finder",level3:"",level4:"",level5:"",country:"us",language:"english",system:"ease_web"},lob:u.getLobArray().join(" | ")}),e.toggleFilterView=function(){e.isFilterExpanded=!e.isFilterExpanded},e.toggleFilterParams=function(t,n){1===e.filterParameters.length&&e.filterParameters[0]===n?t.preventDefault():d.includes(e.filterParameters,n)?(d.remove(e.filterParameters,function(e){return e===n}),i.pubsubTrackAnalytics({name:"remove filter:"+D(n)+":checkbox"})):(e.filterParameters.push(n),i.pubsubTrackAnalytics({name:"apply filter:"+D(n)+":checkbox"}))},e.$watchCollection("filterParameters",y)}]),t});