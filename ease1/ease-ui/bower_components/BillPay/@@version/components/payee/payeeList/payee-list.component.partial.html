<div id="BillPay-payeeList-item-{{$index}}"
    class="payee-list-item"
    ng-class="{bottom: $last}"
    data-ng-repeat="payee in accordionVM.accordionElements | orderBy: accordionVM.accordionParent.getPayeeDisplayName"
    tabindex="-1"
    ng-click="accordionVM.accordionParent.evaluateShouldClose($event) ? accordionVM.setOpenIndex($index) : ''">
  <div class="list-item" ng-class="{'list-item-open': accordionVM.isOpen($index)}">
        <div id="payee-header-{{$index}}" class="list-item-header">
          <button
            class="payee-nickname"
            tabindex="0"
            ng-keydown="accordionVM.accordionParent.openOnlyAD($event) ? accordionVM.setOpenIndex($index) : ''"
            aria-expanded="{{accordionVM.isOpen($index)}}">
            {{(payee.payeeNickname && payee.payeeNickname!=='')? payee.payeeNickname : payee.payeeName}}
          </button>

            <div class="last-payment-info">
                <div ng-if="!accordionVM.accordionParent.checkLatestScheduledTrx(payee) && !accordionVM.accordionParent.checkLastPaymentInfo(payee)">
                </div>
                <div ng-if="payee.totalSameDayScheduledPayments === 1">
                    <span>Scheduled: </span>
                    <span>{{payee.latestScheduledTransactionAmount | currency}} on </span>
                    <span>{{payee.latestScheduledTransactionDate | date : "MMM dd"}}</span>
                </div>
                <div ng-if="payee.totalSameDayScheduledPayments > 1">
                    <span>{{payee.totalSameDayScheduledPayments}} </span>
                    <span>payments scheduled for </span>
                    <span>{{payee.latestScheduledTransactionDate | date : "MMM dd"}} </span>
                    <span>totaling {{payee.latestScheduledTransactionAmount | currency}}</span>
                </div>
                <div ng-if="accordionVM.accordionParent.checkLastPaymentInfo(payee) && !accordionVM.accordionParent.checkLatestScheduledTrx(payee)">
                    <span>Last Paid: </span>
                    <span>{{payee.lastPaymentAmount | currency}} on </span>
                    <span>{{payee.lastPaymentDate | date : "MMM dd"}} </span>
                </div>
            </div>
        </div>

        <accordion-drawer id="BillPay-payeeList-item-detail-{{$index}}"
            class="list-item-contain"
            ng-class="{'drawer-open': accordionVM.isOpen($index) && accordionVM.accordionParent.showSettingsMenu}"
            is-open="accordionVM.isOpen($index)"
            accordion-open="accordionVM.accordionParent.logDrawerOpenEvent('default')"
            accordion-close="accordionVM.accordionParent.logDrawerCloseEvent('transactions'); accordionVM.accordionParent.showSettingsMenu = false"
            aria-hidden="{{!accordionVM.isOpen($index)}}"
            stop-event-prop>
            <div class="payee-displayname"
              ng-show="payee.payeeNameWithAccountLastFour!==''">{{payee.payeeNameWithAccountLastFour}}
            </div>

            <button 
              id="BillPay-makePayment-Button-{{$index}}"
              ng-click="accordionVM.accordionParent.makePayment(payee, $index)"
              ng-disabled="accordionVM.accordionParent.makePaymentLoading"
              class="btn-loadable progressive"
              tabindex="{{accordionVM.isOpen($index) ? 0 : -1}}">
              <span ng-class="{'loading': accordionVM.accordionParent.makePaymentLoading}">
                  {{accordionVM.accordionParent.makePaymentLoading ? '' : 'Make a Payment'}}
              </span>
            </button>

            <div class="payee-action-links" ng-if="accordionVM.accordionParent.accountSubCategory==='360'" id="btn-manage-{{$index}}">
              <button
                 class="action-link"
                 id="btn-manage-payee-{{$index}}"
                 ng-click="accordionVM.accordionParent.showSettingsMenu = !accordionVM.accordionParent.showSettingsMenu"
                 tabindex="{{accordionVM.isOpen($index) ? 0 : -1}}"
                 aria-expanded="{{accordionVM.isOpen($index) && accordionVM.accordionParent.showSettingsMenu}}">
                <span class="manage">Manage</span>
              </button>

              <div class="settings-menu"
                ng-show="accordionVM.isOpen($index) && accordionVM.accordionParent.showSettingsMenu"
                ng-blur="accordionVM.accordionParent.showSettingsMenu = false">
                  <ul>
                    <li>
                      <a href=""
                         id="billpay-recurring-payment-Button-{{$index}}"
                         class="setting setting-add-recurring"
                         ng-class="{'action-loading': accordionVM.accordionParent.recurringPaymentLoading}"
                         ng-click="accordionVM.accordionParent.recurringPayment(payee, $index)">
                        <span ng-class="{'loading': accordionVM.accordionParent.recurringPaymentLoading}">
                          {{ accordionVM.accordionParent.recurringPaymentLoading ? '' : 'Add Recurring Payment'}}
                        </span>
                      </a>
                    </li>
                    <li>
                      <a href=""
                         id="BillPay-deletePayee-Button-{{$index}}"
                         class="setting setting-delete-payee"
                         ng-click="accordionVM.accordionParent.deletePayee(payee, $index)"
                         ng-class="{'action-loading': accordionVM.accordionParent.deletePayeeLoading}">
                        <span ng-class="{'loading': accordionVM.accordionParent.deletePayeeLoading}">
                          {{ accordionVM.accordionParent.deletePayeeLoading ? '' : 'Delete Payee' }}
                        </span>
                      </a>
                    </li>
                    <li>
                      <a href=""
                         id="billpay-button-edit-payee-{{$index}}"
                         class="setting setting-edit-payee"
                         ng-click="accordionVM.accordionParent.editPayee(payee, $index)"
                         ng-class="{'action-loading': accordionVM.accordionParent.editLoading}">
                        <span ng-class="{'loading': accordionVM.accordionParent.editLoading}">
                          {{accordionVM.accordionParent.editLoading ? '' : 'Edit Payee'}}
                        </span>
                      </a>
                    </li>
                  </ul>
              </div><!-- /.settings-menu -->
            </div><!-- /.payee-action-links -->
        </accordion-drawer>

        <div class="border-bottom" ng-class="{'open-border-bottom': accordionVM.isOpen($index)}"></div>
    </div>
</div>
