<ease-ui-modal
  close-modal="addPayeeCtrl.close()"
  modal-title="'Payee Account Info'"
  ng-class="addPayeeCtrl.modalClass">
  <div class="add-payee-modal-container">
    <i class="icon-arrow-back" title="Go back" ng-click="addPayeeCtrl.manualAdd ? addPayeeCtrl.goToAcctNumberAsk() : addPayeeCtrl.goToSearch()"></i>

    <p ng-if="!addPayeeCtrl.manualAdd" class="sub-heading">
      {{ addPayeeCtrl.payeeInfo.payeeName }}<br/>
      {{ addPayeeCtrl.payeeInfo.payeeLocation }}
    </p>

    <form name="payeeAccountInfo" id="payeeAccountInfo">
      <div ng-if="addPayeeCtrl.manualAdd">
        <label for="name">Company or Person Name</label>

        <div class="input-group" ng-class="!payeeAccountInfo.name.$valid ? 'error-border' : '' ">
          <input id="name"
            name="name"
            type="text"
            placeholder="Name"
            ng-model="addPayeeCtrl.payeeInfo.payeeName"
            ng-minlength="2"
            ng-maxlength="33"
            ng-pattern="addPayeeAcctInfoCtrl.alphaNumericRegex"
            aria-describedby="{{ payeeAccountInfo.$valid ? '' : 'bp-ai-error-payeename' }}"
            required />
        </div>

        <div class="error-summary" id="bp-ai-error-payeename">
          <span id="bp-ai-error-payeename-minlength" ng-show="payeeAccountInfo.name.$error.minlength || (payeeAccountInfo.name.$error.required && payeeAccountInfo.name.$touched)">Name should be at least 2 characters</span>
          <span id="bp-ai-error-payeename-maxlength" ng-show="!payeeAccountInfo.name.$error.minlength && payeeAccountInfo.name.$error.maxlength">Name should be less than 33 characters</span>
          <span id="bp-ai-error-payeename-pattern" ng-show="!payeeAccountInfo.name.$error.minlength && !payeeAccountInfo.name.$error.maxlength && payeeAccountInfo.name.$error.pattern">Name can only contain numbers and letters</span>
        </div>
      </div>

      <div ng-if="(!addPayeeCtrl.manualAdd) || addPayeeCtrl.payeeInfo.needAccountNumber">
        <label for="accountNumberOne">Account Number</label>

        <div class="input-group"
             ng-class="(payeeAccountInfo.accountNumberOne.$touched && !payeeAccountInfo.accountNumberOne.$valid)
                || (payeeAccountInfo.accountNumberTwo.$touched && !payeeAccountInfo.accountNumberTwo.$valid)
                || (!addPayeeAcctInfoCtrl.inputMatch && payeeAccountInfo.accountNumberTwo.$touched)
                || (addPayeeAcctInfoCtrl.fixableErrors.indexOf('accountNumberOne') !== -1) ? 'error-border' : ''">

          <input id="accountNumberOne"
            name="accountNumberOne"
            class="input-top"
            type="text"
            placeholder="Enter Account Number"
            ng-model="addPayeeCtrl.payeeInfo.accountNumber"
            ng-model-options="{ updateOn: 'default blur'}"
            required
            disable-paste
            ng-maxlength="32"
            ng-minlegnth="1"
            ng-blur="addPayeeAcctInfoCtrl.compareAccountNumbers(addPayeeCtrl.payeeInfo.accountNumber, addPayeeCtrl.payeeInfo.confirmAccountNumber)"
            ng-change="addPayeeAcctInfoCtrl.compareAccountNumbers(addPayeeCtrl.payeeInfo.confirmAccountNumber, addPayeeCtrl.payeeInfo.accountNumber); addPayeeAcctInfoCtrl.clearError('accountNumberOne')"
            aria-describedby="{{ (!payeeAccountInfo.accountNumberOne.$valid && payeeAccountInfo.accountNumberOne.$touched) || addPayeeAcctInfoCtrl.fixableErrors.indexOf('accountNumberOne') !== -1 || !addPayeeAcctInfoCtrl.inputMatch ? 'bp-ai-error-account' : ''}}" />

          <input id="accountNumberTwo"
            name="accountNumberTwo"
            class="input-bottom"
            type="text"
            aria-labelledby="confirmAccountNumber"
            placeholder="Re-enter Account Number"
            ng-model="addPayeeCtrl.payeeInfo.confirmAccountNumber"
            required
            disable-paste
            ng-maxlength="32"
            ng-minlength="1"
            ng-blur="addPayeeAcctInfoCtrl.compareAccountNumbers(addPayeeCtrl.payeeInfo.confirmAccountNumber, addPayeeCtrl.payeeInfo.accountNumber)"
            ng-change="addPayeeAcctInfoCtrl.compareAccountNumbers(addPayeeCtrl.payeeInfo.confirmAccountNumber, addPayeeCtrl.payeeInfo.accountNumber)"
            aria-describedby="{{ (!payeeAccountInfo.accountNumberTwo.$valid && payeeAccountInfo.accountNumberTwo.$touched) || addPayeeAcctInfoCtrl.fixableErrors.indexOf('accountNumberTwo') !== -1 || !addPayeeAcctInfoCtrl.inputMatch ? 'bp-ai-error-account' : ''}}" />

          <span id="confirmAccountNumber" class="sr-only"> Confirm Account Number </span>
        </div>

        <div class="error-summary" id="bp-ai-error-account">
          <span id="bp-ai-error-account-one-minlength" ng-show="payeeAccountInfo.accountNumberOne.$error.minlength || (payeeAccountInfo.accountNumberOne.$error.required && payeeAccountInfo.accountNumberOne.$touched)">Account number should be at least 1 character</span>
          <span id="bp-ai-error-account-one-maxlength" ng-show="!payeeAccountInfo.accountNumberOne.$error.minlength && payeeAccountInfo.accountNumberOne.$error.maxlength">Account number should be less than 33 characters</span>
          <span id="bp-ai-error-account-one-bad-number" ng-show="addPayeeAcctInfoCtrl.fixableErrors.indexOf('accountNumberOne') !== -1">Account number is incorrect. Please re-enter.</span>
          <span id="bp-ai-error-account-two-minlength" ng-show="payeeAccountInfo.accountNumberTwo.$error.minlength">Account number should be at least 1 character</span>
          <span id="bp-ai-error-account-mismatch" class="error-summary"
          ng-show="(payeeAccountInfo.accountNumberOne.$error.isAccountValid
          || payeeAccountInfo.accountNumberTwo.$error.isAccountValid
          || !addPayeeAcctInfoCtrl.inputMatch) && payeeAccountInfo.accountNumberTwo.$touched">These account numbers do not match</span>
        </div>
      </div>

      <div class="input-group" ng-if="!addPayeeCtrl.manualAdd && addPayeeCtrl.payeeInfo.requiresMerchantPostalCode === true">
        <label for="zipcode">ZIP</label>
        <div ng-class="((payeeAccountInfo.zipcode.$error.pattern && payeeAccountInfo.zipcode.$touched) || addPayeeAcctInfoCtrl.fixableErrors.indexOf('zipcode') !== -1 ) ? 'error-border' :'' ">
          <input id="zipcode"
            name="zipcode"
            type="text"
            placeholder="00000-0000"
            input-mask="zipcode-plus"
            ng-model="addPayeeCtrl.payeeInfo.zipcode"
            ng-maxlength="10"
            ng-pattern="addPayeeAcctInfoCtrl.zipRegex"
            ng-change="addPayeeAcctInfoCtrl.clearError('zipcode')"
            restrict-pattern="\d|[-]"
            required
            aria-describedby="{{ (!payeeAccountInfo.zipcode.$valid && payeeAccountInfo.zipcode.$touched) || addPayeeAcctInfoCtrl.fixableErrors.indexOf('zipcode') !== -1 ? 'bp-ai-error-zc' : '' }}" />
        </div>
      </div>

      <div class="error-summary" id="bp-ai-error-zc">
        <span id="bp-ai-error-zipcode" ng-show="payeeAccountInfo.zipcode.$touched && !payeeAccountInfo.zipcode.$valid">ZIP should be 9 digits</span>
        <span id="bp-ai-error-bad-zipcode" ng-show="addPayeeAcctInfoCtrl.fixableErrors.indexOf('zipcode') !== -1">ZIP Code is invalid. Please re-enter.</span>
      </div>

      <div class="input-group">
        <label for="nickname">Nickname <span class="field-note">Optional, not seen by payee</span></label>
        <div ng-class="(payeeAccountInfo.nickname.$touched && !payeeAccountInfo.nickname.$valid) ? 'error-border' :'' ">
          <input id="nickname" name="nickname" type="text" placeholder="32 Character Limit"
            ng-model="addPayeeCtrl.payeeInfo.nickname" ng-maxlength="30" ng-pattern="addPayeeAcctInfoCtrl.alphaNumericRegex"
            restrict-alpha-numeric
            aria-describedby="{{ !payeeAccountInfo.nickname.$valid ? 'bp-ai-error-nickname' : '' }}" />
        </div>
      </div>

      <div class="error-summary" id="bp-ai-error-nickname">
        <span id="bp-ai-error-nickname-maxlength" ng-show="payeeAccountInfo.nickname.$error.maxlength">Nickname should be less than 31 characters</span>
        <span id="bp-ai-error-nickname-pattern" ng-show="!payeeAccountInfo.nickname.$error.maxlength && payeeAccountInfo.nickname.$error.pattern">Nickname can only contain numbers and letters</span>
      </div>

      <button id="payeeAccountInfoBtnSubmit"
        ng-if="!addPayeeCtrl.manualAdd"
        ng-click="addPayeeAcctInfoCtrl.submitAcctInfo(addPayeeCtrl.payeeInfo)"
        class="btn-loadable"
        ng-disabled="payeeAccountInfo.$invalid || !addPayeeAcctInfoCtrl.inputMatch || addPayeeAcctInfoCtrl.fixableErrors.length || addPayeeAcctInfoCtrl.requestInProgress"
        aria-disabled="{{(payeeAccountInfo.$invalid || !addPayeeAcctInfoCtrl.inputMatch || addPayeeAcctInfoCtrl.fixableErrors.length || addPayeeAcctInfoCtrl.requestInProgress) ? 'true' : 'false'}}">
        <span ng-class="{'loading': addPayeeAcctInfoCtrl.requestInProgress}">
          {{ addPayeeAcctInfoCtrl.requestInProgress ? '' : 'Add Payee' }}
        </span>
      </button>

      <button id="payeeAccountInfoBtnContinue"
        ng-if="addPayeeCtrl.manualAdd"
        ui-sref="BillPay.addPayee.contactInfo"
        class="btn-loadable progressive"
        ng-disabled="payeeAccountInfo.$invalid || !addPayeeAcctInfoCtrl.inputMatch || addPayeeAcctInfoCtrl.fixableErrors.length"
        aria-disabled="{{ (payeeAccountInfo.$invalid || !addPayeeAcctInfoCtrl.inputMatch || addPayeeAcctInfoCtrl.fixableErrors.length) ? 'true' : 'false'}}">
        <span>Continue</span>
      </button>
    </form>
  </div>
</ease-ui-modal>
