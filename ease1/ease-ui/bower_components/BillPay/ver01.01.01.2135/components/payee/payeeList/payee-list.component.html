<section
  class="payee-list-item"
  ng-class="{'bottom': $index === $ctrl.payeeList.length - 1}"
  ng-repeat="payee in $ctrl.payeeList | orderBy: 'payeeName'">

  <div id="payee-header-{{$index}}"
    class="list-item-header"
    tabindex="-1"
    ng-click="$ctrl.evaluateShouldClose($event) ? $ctrl.openDrawer($index) : ''">
    <button
      class="payee-nickname"
      id="btn-payee-nickname-{{$index}}"
      tabindex="0"
      ng-keydown="$ctrl.openOnlyAD($event) ? $ctrl.openDrawer($index) : ''"
      aria-expanded="{{$ctrl.openDrawerId == $index}}">
      {{(payee.payeeNickname && payee.payeeNickname!=='')? payee.payeeNickname : payee.payeeName}}
    </button>

    <div class="last-payment-info">
      <div ng-if="!$ctrl.checkLatestScheduledTrx(payee) && !$ctrl.checkLastPaymentInfo(payee)">
      </div>
      <div ng-if="payee.totalSameDayScheduledPayments === 1">
        <span>Scheduled: </span>
        <span>{{payee.latestScheduledTransactionAmount | currency}} on </span>
        <span>{{payee.latestScheduledTransactionDate | date : "MMM dd"}}</span>
      </div>
      <div ng-if="payee.totalSameDayScheduledPayments > 1">
        <span>{{payee.totalSameDayScheduledPayments}} </span>
        <span>payments scheduled for </span>
        <span>{{payee.latestScheduledTransactionDate | date : "MMM dd"}} </span>
        <span>totaling {{payee.latestScheduledTransactionAmount | currency}}</span>
      </div>
      <div ng-if="$ctrl.checkLastPaymentInfo(payee) && !$ctrl.checkLatestScheduledTrx(payee)">
        <span>Last Paid: </span>
        <span>{{payee.lastPaymentAmount | currency}} on </span>
        <span>{{payee.lastPaymentDate | date : "MMM dd"}} </span>
      </div>
    </div>
  </div><!-- /.list-item-header -->

  <ease-drawer drawer-id="'BillPay-payeeList-item-detail-' + $index" is-click-enabled="false" tabindex="-1">
    <div class="payee-displayname" ng-show="payee.payeeNameWithAccountLastFour !== ''">
      {{ payee.payeeNameWithAccountLastFour }}
    </div>

    <button
      id="BillPay-makePayment-Button-{{$index}}"
      ng-show="$ctrl.features.oneTimePayment && $ctrl.features.payeeDetail && $ctrl.features.getAccount"
      ng-click="$ctrl.makePayment(payee, $index)"
      ng-disabled="$ctrl.makePaymentLoading"
      class="btn-loadable progressive">
      <span ng-class="{'loading': $ctrl.makePaymentLoading}">
          {{$ctrl.makePaymentLoading ? '' : 'Make a Payment'}}
      </span>
    </button>

    <div class="payee-action-links" ng-if="$ctrl.accountSubCategory==='360' && $ctrl.features.payeeDetail">
      <manage-payee
        id="btn-manage-{{$index}}"
        uid="{{$index}}"
        show-menu="$ctrl.showSettingsMenu[$index]"
        recurring-payment="$ctrl.recurringPayment(payee, $index)"
        recurring-payment-loading="$ctrl.recurringPaymentLoading"
        delete-payee="$ctrl.deletePayee(payee, $index)"
        delete-payee-loading="$ctrl.deletePayeeLoading"
        edit-payee="$ctrl.editPayee(payee, $index)"
        edit-loading="$ctrl.editLoading"
        payee-type="{{$ctrl.getPayeeType(payee)}}">
      </manage-payee>
    </div><!-- /.payee-action-links -->
  </ease-drawer>
</section>
